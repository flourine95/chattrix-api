openapi: 3.0.1
info:
  title: Chattrix API
  description: |
    API toÃ n diá»‡n cho á»©ng dá»¥ng Chattrix, bao gá»“m xÃ¡c thá»±c, quáº£n lÃ½ ngÆ°á»i dÃ¹ng, vÃ  tÃ­nh nÄƒng gá»i Ä‘iá»‡n thá»i gian thá»±c.

    ---

    ### Chi tiáº¿t cÃ¡c sá»± kiá»‡n WebSocket
    Táº¥t cáº£ cÃ¡c tin nháº¯n tá»« server Ä‘á»u Ä‘Æ°á»£c bá»c trong má»™t Ä‘á»‘i tÆ°á»£ng `WebSocketMessage` chung.
    
    **Message Events:**
    *   **`chat.message`**: Tin nháº¯n trÃ² chuyá»‡n má»›i. (Payload: `OutgoingMessageDto`)
    *   **`message.updated`**: Má»™t tin nháº¯n Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t. (Payload: `MessageUpdateDto`)
    *   **`message.deleted`**: Má»™t tin nháº¯n Ä‘Ã£ bá»‹ xÃ³a. (Payload: `MessageDeleteDto`)
    *   **`message.reaction`**: Reaction Ä‘Ã£ Ä‘Æ°á»£c thÃªm/xÃ³a khá»i tin nháº¯n. (Payload: `ReactionEventDto`)
    
    **Conversation Events:**
    *   **`conversation.update`**: ThÃ´ng tin cuá»™c trÃ² chuyá»‡n Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t (vÃ­ dá»¥: tin nháº¯n cuá»‘i cÃ¹ng). (Payload: `ConversationUpdateDto`)
    *   **`typing.indicator`**: User Ä‘ang typing trong conversation. (Payload: `TypingIndicatorResponseDto`)
    
    **User Events:**
    *   **`user.status`**: Tráº¡ng thÃ¡i trá»±c tuyáº¿n cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ thay Ä‘á»•i. (Payload: `UserStatusDto`)
    
    **Friend Request Events:**
    *   **`friend.request.received`**: Nháº­n Ä‘Æ°á»£c friend request má»›i. (Payload: `FriendRequestResponse`)
    *   **`friend.request.accepted`**: Friend request Ä‘Æ°á»£c cháº¥p nháº­n. (Payload: `FriendRequestResponse`)
    *   **`friend.request.rejected`**: Friend request bá»‹ tá»« chá»‘i. (Payload: `FriendRequestRejectDto`)
    *   **`friend.request.cancelled`**: Friend request bá»‹ há»§y bá»Ÿi ngÆ°á»i gá»­i. (Payload: `FriendRequestCancelDto`)
    
    **Note Events:**
    *   **`note.created`**: Note má»›i Ä‘Æ°á»£c táº¡o tá»« contact. (Payload: `UserNoteDto`)
    *   **`note.updated`**: Note cá»§a contact Ä‘Æ°á»£c cáº­p nháº­t. (Payload: `UserNoteDto`)
    *   **`note.deleted`**: Note cá»§a contact bá»‹ xÃ³a. (Payload: `NoteDeleteDto`)
    
    **Call Events:**
    *   **`call.incoming`**: ThÃ´ng bÃ¡o cÃ³ cuá»™c gá»i Ä‘áº¿n. (Payload: `CallInvitationDto`)
    *   **`call.accepted`**: Cuá»™c gá»i Ä‘Ã£ Ä‘Æ°á»£c cháº¥p nháº­n. (Payload: `CallAcceptDto`)
    *   **`call.rejected`**: Cuá»™c gá»i Ä‘Ã£ bá»‹ tá»« chá»‘i. (Payload: `CallRejectDto`)
    *   **`call.ended`**: Cuá»™c gá»i Ä‘Ã£ káº¿t thÃºc. (Payload: `CallEndDto`)
    *   **`call.timeout`**: Cuá»™c gá»i háº¿t thá»i gian chá». (Payload: `CallTimeoutDto`)
  version: "1.0.0"
servers:
  - url: /api
    description: Server API chÃ­nh

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    # --- Auth & User Schemas ---
    LoginRequest:
      type: object
      required: [usernameOrEmail, password]
      properties:
        usernameOrEmail: { type: string, description: "TÃªn Ä‘Äƒng nháº­p hoáº·c email cá»§a ngÆ°á»i dÃ¹ng." }
        password: { type: string, format: password, description: "Máº­t kháº©u." }

    RegisterRequest:
      type: object
      required: [username, email, password, fullName]
      properties:
        username:
          type: string
          minLength: 4
          maxLength: 20
          pattern: '^(?![_.])(?!.*[_.]{2})(?=.*[a-zA-Z])[a-zA-Z0-9._]+(?<![_.])$'
          description: "Username (4-20 chars, must contain letter, no leading/trailing . or _)"
        email:
          type: string
          format: email
          description: "Valid email address"
        password:
          type: string
          format: password
          minLength: 6
          maxLength: 100
          description: "Password (min 6 characters)"
        fullName:
          type: string
          minLength: 1
          maxLength: 100
          description: "Full name"

    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken:
          type: string
          description: "Refresh token tá»« login/refresh response"

    ChangePasswordRequest:
      type: object
      required: [currentPassword, newPassword]
      properties:
        currentPassword:
          type: string
          description: "Current password"
        newPassword:
          type: string
          minLength: 6
          maxLength: 100
          description: "New password (min 6 characters)"

    VerifyEmailRequest:
      type: object
      required: [email, otp]
      properties:
        email:
          type: string
          format: email
          description: "Email address to verify"
        otp:
          type: string
          pattern: '^[0-9]{6}$'
          description: "6-digit OTP from email"

    ResendVerificationRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
          description: "Email address to resend verification"

    ForgotPasswordRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
          description: "Email address for password reset"

    ResetPasswordRequest:
      type: object
      required: [email, otp, newPassword]
      properties:
        email:
          type: string
          format: email
          description: "Email address"
        otp:
          type: string
          pattern: '^[0-9]{6}$'
          description: "6-digit OTP from email"
        newPassword:
          type: string
          minLength: 6
          maxLength: 100
          description: "New password (min 6 characters)"

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: "JWT access token"
        refreshToken:
          type: string
          description: "Refresh token UUID"
        tokenType:
          type: string
          example: "Bearer"
          default: "Bearer"
        expiresIn:
          type: integer
          format: int64
          description: "Access token expiry time in seconds"
          example: 86400

    UserResponse:
      type: object
      description: "Complete user information (same as UserProfileResponse)"
      properties:
        id: { type: integer, format: int64 }
        username: { type: string }
        email: { type: string, format: email }
        emailVerified: { type: boolean }
        phone: { type: string, nullable: true }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        bio: { type: string, maxLength: 500, nullable: true }
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER]
          nullable: true
        dateOfBirth: { type: string, format: date-time, nullable: true }
        location: { type: string, nullable: true }
        profileVisibility:
          type: string
          enum: [PUBLIC, FRIENDS_ONLY, PRIVATE]
          nullable: true
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time, nullable: true }

    UserProfileResponse:
      deprecated: true
      description: "DEPRECATED: Use UserResponse instead. This schema is identical to UserResponse."
      allOf:
        - $ref: '#/components/schemas/UserResponse'

    # --- Message Schemas ---
    MessageResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        senderId: { type: integer, format: int64 }
        senderUsername: { type: string, nullable: true }
        senderFullName: { type: string, nullable: true }
        content: { type: string, nullable: true }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION], description: "Message type" }
        # Rich media fields
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true, description: "Duration in seconds for audio/video" }
        # Location fields
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }
        # Reply context
        replyToMessageId: { type: integer, format: int64, nullable: true }
        replyToMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
        # Reactions: {"ğŸ‘": [1, 2, 3], "â¤ï¸": [4, 5]}
        reactions:
          type: object
          description: "Map of emoji to array of user IDs"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        # Mentions
        mentions:
          type: array
          nullable: true
          items:
            type: integer
            format: int64
        mentionedUsers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }
        # Timestamps
        sentAt: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        # Edit/Delete/Forward
        edited: { type: boolean, default: false }
        editedAt: { type: string, format: date-time, nullable: true }
        deleted: { type: boolean, default: false }
        deletedAt: { type: string, format: date-time, nullable: true }
        forwarded: { type: boolean, default: false }
        originalMessageId: { type: integer, format: int64, nullable: true }
        forwardCount: { type: integer, format: int32, default: 0 }
        # Read receipts
        readCount: { type: integer, format: int64, default: 0 }
        readBy:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }
              avatarUrl: { type: string }
              readAt: { type: string, format: date-time }
      example:
        id: 5
        conversationId: 1
        senderId: 2
        senderUsername: "user2"
        senderFullName: "Tran Van Binh"
        content: "HÃ¬ hÃ¬ Ä‘Ãºng tháº­t, cÅ©ng Ä‘Ã£ nhiá»u nÄƒm trÃ´i qua"
        type: "TEXT"
        reactions: {}
        sentAt: "2025-12-14T06:18:25.432835Z"
        createdAt: "2025-12-14T06:18:25.432836Z"
        updatedAt: "2025-12-14T06:18:25.432837Z"
        edited: false
        deleted: false
        forwarded: false
        forwardCount: 0
        readCount: 1
        readBy:
          - userId: 1
            username: "user1"
            fullName: "Nguyen Linh La"
            avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
            readAt: "2025-12-14T06:50:24.557Z"

    ChatMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION], default: TEXT }
        replyToMessageId: { type: integer, format: int64, nullable: true }
        mentions:
          type: array
          items:
            type: integer
            format: int64
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }

    UpdateMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string, description: "Ná»™i dung má»›i cá»§a tin nháº¯n." }

    # --- Call Schemas ---
    CallResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        channelId: { type: string }
        status: { type: string, enum: [RINGING, CONNECTING, CONNECTED, REJECTED, ENDED, INITIATING] }
        callType: { type: string, enum: [AUDIO, VIDEO] }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri, nullable: true }
        calleeId: { type: integer, format: int64 }
        calleeName: { type: string }
        calleeAvatar: { type: string, format: uri, nullable: true }
        createdAt: { type: string, format: date-time }
        durationSeconds: { type: integer, nullable: true }

    CallConnectionResponse:
      type: object
      properties:
        callInfo: { $ref: '#/components/schemas/CallResponse' }
        token: { type: string, description: "Token (vÃ­ dá»¥: Agora Token) Ä‘á»ƒ káº¿t ná»‘i vÃ o phiÃªn gá»i." }

    # --- Generic API Response Wrappers ---
    ApiResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { nullable: true }

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              example: "RESOURCE_NOT_FOUND"
            message:
              type: string
              example: "The requested resource was not found"
            details:
              type: array
              description: "Array of detailed error information (present for validation errors)"
              items:
                $ref: '#/components/schemas/ErrorDetail'
        requestId:
          type: string
          example: "req-12345-abcde"

    ErrorDetail:
      type: object
      required:
        - field
        - message
      properties:
        field:
          type: string
          description: "The field name that failed validation"
          example: "email"
        code:
          type: string
          description: "Error code for internationalization (e.g., UNIQUE_EMAIL, NOT_BLANK)"
          example: "UNIQUE_EMAIL"
        message:
          type: string
          description: "Human-readable error message"
          example: "Email already exists"

    ApiResponse_AuthResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/AuthResponse' }

    ApiResponse_UserResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserResponse' }
    
    ApiResponse_UserListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'

    ApiResponse_MessageResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageResponse' }

    ApiResponse_MessageListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/MessageResponse'

    ApiResponse_CallConnectionResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallConnectionResponse' }

    ApiResponse_CallResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallResponse' }

    # --- Request Schemas ---
    InitiateCallRequest:
      type: object
      required: [calleeId, callType]
      properties:
        calleeId: { type: integer, format: int64 }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    RejectCallRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, enum: [busy, declined, unavailable] }

    EndCallRequest:
      type: object
      properties:
        reason: { type: string, enum: [hangup, "network error", "device error", timeout], default: "hangup" }

    # --- WebSocket DTOs ---
    OutgoingMessageDto:
      type: object
      description: "WebSocket payload for new chat message (event: chat.message)"
      properties:
        id: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        sender:
          type: object
          properties:
            id: { type: integer, format: int64 }
            username: { type: string }
            fullName: { type: string }
            avatarUrl: { type: string, format: uri, nullable: true }
        content: { type: string }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION] }
        createdAt: { type: string, format: date-time }
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }
        replyToMessageId: { type: integer, format: int64, nullable: true }
        replyToMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
        reactions:
          type: object
          description: "Map of emoji to array of user IDs"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        mentions:
          type: array
          nullable: true
          items:
            type: integer
            format: int64
        mentionedUsers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }

    MessageUpdateDto:
      type: object
      description: "WebSocket payload for message update (event: message.updated)"
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        content: { type: string }
        edited: { type: boolean }
        updatedAt: { type: string, format: date-time }

    MessageDeleteDto:
      type: object
      description: "WebSocket payload for message deletion (event: message.deleted)"
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }

    ConversationUpdateDto:
      type: object
      description: "WebSocket payload for conversation update (event: conversation.update)"
      properties:
        conversationId: { type: integer, format: int64 }
        updatedAt: { type: string, format: date-time }
        lastMessage:
          type: object
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
            sentAt: { type: string, format: date-time }
            type: { type: string }

    ReactionEventDto:
      type: object
      description: "WebSocket payload for reaction events (event: message.reaction)"
      properties:
        messageId: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        userName: { type: string }
        emoji: { type: string }
        action: { type: string, enum: [add, remove] }
        reactions:
          type: object
          description: "Updated reactions map"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        timestamp: { type: string, format: date-time }

    TypingIndicatorDto:
      type: object
      description: "Client-to-server payload for typing indicator (send to server)"
      properties:
        conversationId: { type: integer, format: int64 }
        typing: { type: boolean, description: "true = start typing, false = stop typing" }

    TypingIndicatorResponseDto:
      type: object
      description: "WebSocket payload for typing indicator (event: typing.indicator)"
      properties:
        conversationId: { type: integer, format: int64 }
        typingUsers:
          type: array
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }

    UserStatusDto:
      type: object
      description: "WebSocket payload for user status change (event: user.status)"
      properties:
        userId: { type: string }
        username: { type: string }
        fullName: { type: string }
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }

    FriendRequestRejectDto:
      type: object
      description: "WebSocket payload for friend request rejected (event: friend.request.rejected)"
      properties:
        requestId: { type: integer, format: int64 }
        rejectedBy: { type: integer, format: int64 }

    FriendRequestCancelDto:
      type: object
      description: "WebSocket payload for friend request cancelled (event: friend.request.cancelled)"
      properties:
        requestId: { type: integer, format: int64 }
        cancelledBy: { type: integer, format: int64 }

    CallInvitationDto:
      type: object
      description: "WebSocket payload for incoming call (event: call.incoming)"
      properties:
        callId: { type: string }
        channelId: { type: string }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri, nullable: true }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    CallAcceptDto:
      type: object
      description: "WebSocket payload for call accepted (event: call.accepted)"
      properties:
        callId: { type: string }
        acceptedBy: { type: integer, format: int64 }

    CallRejectDto:
      type: object
      description: "WebSocket payload for call rejected (event: call.rejected)"
      properties:
        callId: { type: string }
        rejectedBy: { type: integer, format: int64 }
        reason: { type: string, enum: [busy, declined, unavailable] }

    CallEndDto:
      type: object
      description: "WebSocket payload for call ended (event: call.ended)"
      properties:
        callId: { type: string }
        endedBy: { type: integer, format: int64 }
        durationSeconds: { type: integer }

    CallTimeoutDto:
      type: object
      description: "WebSocket payload for call timeout (event: call.timeout)"
      properties:
        callId: { type: string }
        reason: { type: string, example: "no_answer" }


    # --- Contacts & Social Schemas ---
    ContactResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        contactUserId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        nickname: { type: string, nullable: true }
        favorite: { type: boolean }
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }
      example:
        id: 5
        contactUserId: 10
        username: "user10"
        fullName: "Nguyen Van A"
        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
        nickname: "Best Friend"
        favorite: true
        online: true
        lastSeen: "2025-12-14T08:30:15.123Z"
        createdAt: "2025-12-10T10:20:30.456Z"

    AddContactRequest:
      type: object
      required: [contactUserId]
      properties:
        contactUserId:
          type: integer
          format: int64
          description: "User ID cá»§a ngÆ°á»i cáº§n add vÃ o contacts"
        nickname:
          type: string
          nullable: true
          description: "Nickname cho contact (optional)"

    UpdateContactRequest:
      type: object
      properties:
        nickname:
          type: string
          nullable: true
          description: "Update nickname"
        isFavorite:
          type: boolean
          nullable: true
          description: "Mark as favorite hoáº·c unfavorite"

    FriendRequestResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64, description: "ID cá»§a ngÆ°á»i gá»­i/nháº­n (tÃ¹y context)" }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        status: { type: string, enum: [PENDING, ACCEPTED, REJECTED, BLOCKED] }
        nickname: { type: string, nullable: true }
        online: { type: boolean }
        requestedAt: { type: string, format: date-time }
        acceptedAt: { type: string, format: date-time, nullable: true }
        rejectedAt: { type: string, format: date-time, nullable: true }
      example:
        id: 15
        userId: 20
        username: "user20"
        fullName: "Tran Thi B"
        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/20.png"
        status: "PENDING"
        nickname: null
        online: false
        requestedAt: "2025-12-14T07:00:00.000Z"
        acceptedAt: null
        rejectedAt: null

    SendFriendRequestRequest:
      type: object
      required: [receiverUserId]
      properties:
        receiverUserId:
          type: integer
          format: int64
          description: "User ID cá»§a ngÆ°á»i nháº­n friend request"
        nickname:
          type: string
          nullable: true
          description: "Nickname cho friend (optional)"

    # --- Read Receipts Schemas ---
    ReadReceiptResponse:
      type: object
      properties:
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        readAt: { type: string, format: date-time }

    # --- Reaction Schemas ---
    AddReactionRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10 }

    MessageReactionsResponse:
      type: object
      properties:
        messageId: { type: integer, format: int64 }
        reactions:
          type: object
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
          description: "Map of emoji to array of user IDs. Example: {'ğŸ‘': [1, 2, 3], 'â¤ï¸': [4, 5]}"

    # --- Conversation Members Schemas ---
    ConversationParticipantResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        user: { $ref: '#/components/schemas/UserResponse' }
        role: { type: string, enum: [ADMIN, MEMBER] }
        joinedAt: { type: string, format: date-time }
        unreadCount: { type: integer }

    AddMembersRequest:
      type: object
      required: [userIds]
      properties:
        userIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateMemberRoleRequest:
      type: object
      required: [role]
      properties:
        role: { type: string, enum: [ADMIN, MEMBER] }

    # --- Conversation Schemas ---
    ConversationResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        name: { type: string, nullable: true, description: "TÃªn conversation (chá»‰ cÃ³ trong GROUP)" }
        type: { type: string, enum: [DIRECT, GROUP] }
        avatarUrl: { type: string, format: uri, nullable: true, description: "Avatar URL (chá»‰ cÃ³ trong GROUP)" }
        participants:
          type: array
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              role: { type: string, enum: [ADMIN, MEMBER] }
          description: "Danh sÃ¡ch participants vá»›i userId, username vÃ  role"
        lastMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
            sentAt: { type: string, format: date-time }
            type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION] }
            readCount: { type: integer, format: int64 }
            readBy:
              type: array
              items:
                type: object
                properties:
                  userId: { type: integer, format: int64 }
                  username: { type: string }
                  fullName: { type: string }
                  avatarUrl: { type: string }
                  readAt: { type: string, format: date-time }
          description: "Last message in the conversation, or null if empty."
        unreadCount: { type: integer, description: "Sá»‘ tin nháº¯n chÆ°a Ä‘á»c" }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      example:
        id: 1
        type: "DIRECT"
        createdAt: "2025-12-14T05:57:39.801682Z"
        updatedAt: "2025-12-14T06:29:24.717139Z"
        participants:
          - userId: 1
            username: "user1"
            role: "ADMIN"
          - userId: 2
            username: "user2"
            role: "MEMBER"
        lastMessage:
          id: 8
          content: "Tao pháº£i Ä‘á»¡ cho em tao"
          senderId: 2
          senderUsername: "user2"
          sentAt: "2025-12-14T06:29:24.691046Z"
          type: "TEXT"
          readCount: 0
          readBy: []
        unreadCount: 4

    CreateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        type: { type: string, enum: [DIRECT, GROUP], default: DIRECT }
        participantIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }

    # --- User Profile Schemas ---
    UpdateProfileRequest:
      type: object
      properties:
        fullName: { type: string, nullable: true }
        bio: { type: string, maxLength: 500, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }
        phone: { type: string, nullable: true }
        dateOfBirth: { type: string, format: date, nullable: true }
        gender: { type: string, enum: [MALE, FEMALE, OTHER], nullable: true }
        location: { type: string, nullable: true }

    # --- API Response Wrappers ---
    ApiResponse_ContactResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ContactResponse' }

    ApiResponse_ContactListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ContactResponse'

    ApiResponse_ReadReceiptListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ReadReceiptResponse'

    ApiResponse_MessageReactionsResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageReactionsResponse' }

    ApiResponse_ConversationResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ConversationResponse' }

    PaginatedResponse:
      type: object
      description: "Generic paginated response with metadata"
      properties:
        data:
          type: array
          items: {}
          description: "Array of items for current page"
        page:
          type: integer
          format: int32
          description: "Current page number (0-indexed)"
          example: 0
        size:
          type: integer
          format: int32
          description: "Page size (items per page)"
          example: 20
        total:
          type: integer
          format: int64
          description: "Total number of items across all pages"
          example: 45
        totalPages:
          type: integer
          format: int32
          description: "Total number of pages"
          example: 3
        hasNextPage:
          type: boolean
          description: "Whether there is a next page"
          example: true
        hasPrevPage:
          type: boolean
          description: "Whether there is a previous page"
          example: false

    PaginatedConversationResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/ConversationResponse'

    UserSearchResponse:
      type: object
      description: "User search result with additional context (contact status, conversation info)"
      properties:
        id: { type: integer, format: int64 }
        username: { type: string }
        email: { type: string, format: email }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }
        contact:
          type: boolean
          description: "Whether this user is in current user's contact list"
        hasConversation:
          type: boolean
          description: "Whether a conversation exists with this user"
        conversationId:
          type: integer
          format: int64
          nullable: true
          description: "Conversation ID if exists"

    PaginatedUserSearchResponse:
      allOf:
        - $ref: '#/components/schemas/PaginatedResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/UserSearchResponse'

    ApiResponse_ConversationListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          $ref: '#/components/schemas/PaginatedConversationResponse'

    ApiResponse_ParticipantListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConversationParticipantResponse'

    # --- Messenger Notes Schemas ---
    UserNoteRequest:
      type: object
      required: [noteText]
      properties:
        noteText:
          type: string
          maxLength: 60
          description: "Ná»™i dung note (tá»‘i Ä‘a 60 kÃ½ tá»±)."
        musicUrl:
          type: string
          format: uri
          nullable: true
          description: "URL nháº¡c Ä‘Ã­nh kÃ¨m (optional)."
        musicTitle:
          type: string
          maxLength: 100
          nullable: true
          description: "TÃªn bÃ i nháº¡c (optional)."
        emoji:
          type: string
          maxLength: 10
          nullable: true
          description: "Emoji Ä‘áº¡i diá»‡n (optional)."

    UserNoteResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        noteText: { type: string, maxLength: 60 }
        musicUrl: { type: string, format: uri, nullable: true }
        musicTitle: { type: string, nullable: true }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time, description: "Note tá»± Ä‘á»™ng xÃ³a sau 24h." }
        replyCount: { type: integer, format: int64, description: "Tá»•ng sá»‘ messages (replies + reactions)." }

    NoteReplyRequest:
      type: object
      required: [replyText]
      properties:
        replyText: { type: string, description: "Ná»™i dung reply." }

    NoteReactRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10, description: "Emoji reaction." }

    UserNoteDto:
      type: object
      description: "WebSocket payload cho note events."
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        noteText: { type: string }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time }

    NoteDeleteDto:
      type: object
      properties:
        userId: { type: integer, format: int64 }

    ApiResponse_UserNoteResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserNoteResponse' }

    ApiResponse_UserNoteListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserNoteResponse'

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: "CÃ¡c API liÃªn quan Ä‘áº¿n xÃ¡c thá»±c, Ä‘Äƒng nháº­p, Ä‘Äƒng kÃ½ vÃ  quáº£n lÃ½ phiÃªn lÃ m viá»‡c."
  - name: Users
    description: "CÃ¡c API liÃªn quan Ä‘áº¿n quáº£n lÃ½ ngÆ°á»i dÃ¹ng."
  - name: Conversations
    description: "CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ cuá»™c trÃ² chuyá»‡n."
  - name: Messages
    description: "CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ tin nháº¯n trong cuá»™c trÃ² chuyá»‡n."
  - name: Notes
    description: "CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ Messenger Notes (status 24h trÃªn avatar)."
  - name: Contacts
    description: "CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ danh báº¡ vÃ  báº¡n bÃ¨."
  - name: Social
    description: "CÃ¡c API cho tÃ­nh nÄƒng xÃ£ há»™i (friend requests, etc)."
  - name: Call
    description: "CÃ¡c API Ä‘á»ƒ quáº£n lÃ½ tÃ­nh nÄƒng gá»i Ä‘iá»‡n."

paths:
  # --- Auth Paths ---
  /v1/auth/register:
    post:
      summary: "User Registration"
      description: |
        ÄÄƒng kÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng má»›i.
        
        **Flow:**
        1. Validate input (username, email, password, fullName)
        2. Create user account
        3. Generate avatar automatically from Cloudinary
        4. Send verification email with 6-digit OTP
        5. User must verify email before login
        
        **Rate Limit:** 3 requests per 5 minutes
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RegisterRequest' }
            example:
              username: "newuser123"
              email: "newuser@example.com"
              password: "SecurePass123"
              fullName: "New User"
      responses:
        '201':
          description: "Registration successful. Verification email sent."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Registration successful. Please check your email to verify your account."
                data: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                username_taken:
                  summary: "Username already exists"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "username"
                          code: "UNIQUE_USERNAME"
                          message: "Username already exists"
                    requestId: "req-reg001"
                email_taken:
                  summary: "Email already registered"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "email"
                          code: "UNIQUE_EMAIL"
                          message: "Email already exists"
                    requestId: "req-reg002"
                multiple_validation_errors:
                  summary: "Multiple validation errors"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "email"
                          code: "UNIQUE_EMAIL"
                          message: "Email already exists"
                        - field: "username"
                          code: "UNIQUE_USERNAME"
                          message: "Username already exists"
                    requestId: "req-reg003"
                invalid_username:
                  summary: "Invalid username format"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "username"
                          code: "PATTERN"
                          message: "Username must contain at least one letter, and cannot start or end with '.' or '_'"
                    requestId: "req-reg004"
                username_too_short:
                  summary: "Username too short"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "username"
                          code: "SIZE"
                          message: "Username must be between 4 and 20 characters"
                    requestId: "req-reg005"
                invalid_email:
                  summary: "Invalid email format"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "email"
                          code: "EMAIL"
                          message: "Email must be valid"
                    requestId: "req-reg006"
                password_too_short:
                  summary: "Password too short"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "password"
                          code: "SIZE"
                          message: "Password must be at least 6 characters"
                    requestId: "req-reg007"
                missing_fullname:
                  summary: "Full name missing"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "fullName"
                          code: "NOT_BLANK"
                          message: "Full name cannot be blank"
                    requestId: "req-reg008"
        '429':
          description: "Too Many Requests - Rate limit exceeded"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many registration attempts. Please try again later."
                requestId: "req-reg008"

  /v1/auth/login:
    post:
      summary: "User Login"
      description: |
        XÃ¡c thá»±c ngÆ°á»i dÃ¹ng Ä‘á»ƒ nháº­n access token vÃ  refresh token.
        
        **Flow:**
        1. Validate credentials (username/email + password)
        2. Check email verified
        3. Mark user as online
        4. Generate access token (JWT) vÃ  refresh token
        5. Return tokens
        
        **Rate Limit:** 10 requests per 60 seconds
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
            examples:
              with_username:
                summary: "Login with username"
                value:
                  usernameOrEmail: "user1"
                  password: "password123"
              with_email:
                summary: "Login with email"
                value:
                  usernameOrEmail: "user1@example.com"
                  password: "password123"
      responses:
        '200':
          description: "Login successful. Tokens returned."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/AuthResponse' }
              example:
                success: true
                message: "Login successful"
                data:
                  accessToken: "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwidXNlcm5hbWUiOiJ1c2VyMSIsImp0aSI6ImZmYjM4NjU5LTMwMWUtNGQzNy1hNWQ1LTljNGIzNTUzNGYzMiIsImlhdCI6MTc2NTY5NDkxOSwiZXhwIjoxNzY1OTEwOTE5fQ.FjPFJXewRaHQg8ulpVXxbHAUoo24UH7hRdPA7mWzeO0"
                  refreshToken: "d47f9e4c-8b2a-4e1f-9c3d-5a6b7c8d9e0f"
                  tokenType: "Bearer"
                  expiresIn: 86400
        '400':
          description: "Bad Request - Missing fields."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "usernameOrEmail"
                      code: "NOT_BLANK"
                      message: "Username or email cannot be blank"
                requestId: "req-login001"
        '401':
          description: "Unauthorized - Invalid credentials or email not verified."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_credentials:
                  summary: "Wrong username/email or password"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid username/email or password"
                    requestId: "req-login002"
                email_not_verified:
                  summary: "Email not verified"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Email not verified. Please check your email to verify your account."
                    requestId: "req-login003"
        '429':
          description: "Too Many Requests - Rate limit exceeded"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many login attempts. Please try again later."
                requestId: "req-login004"

  /v1/auth/refresh:
    post:
      summary: "Refresh Access Token"
      description: |
        Sá»­ dá»¥ng refresh token Ä‘á»ƒ láº¥y access token má»›i.
        
        **Flow:**
        1. Validate refresh token
        2. Invalidate old access token (if still valid)
        3. Revoke old refresh token
        4. Generate new access token vÃ  refresh token
        5. Return new tokens
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshTokenRequest' }
            example:
              refreshToken: "d47f9e4c-8b2a-4e1f-9c3d-5a6b7c8d9e0f"
      responses:
        '200':
          description: "Token refreshed successfully. New tokens returned."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/AuthResponse' }
              example:
                success: true
                message: "Token refreshed successfully"
                data:
                  accessToken: "eyJhbGciOiJIUzI1NiJ9.new_token_here..."
                  refreshToken: "new_refresh_token_uuid"
                  tokenType: "Bearer"
                  expiresIn: 86400
        '401':
          description: "Unauthorized - Invalid or expired refresh token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_token:
                  summary: "Invalid refresh token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired refresh token"
                    requestId: "req-refresh001"
                token_revoked:
                  summary: "Token already revoked"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Refresh token has been revoked"
                    requestId: "req-refresh002"

  /v1/auth/me:
    get:
      summary: "Get Current User Info"
      description: "Láº¥y thÃ´ng tin chi tiáº¿t cá»§a ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p, dá»±a trÃªn token xÃ¡c thá»±c."
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "User retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
              example:
                success: true
                message: "User retrieved successfully"
                data:
                  id: 1
                  username: "user1"
                  email: "user1@example.com"
                  emailVerified: true
                  phone: null
                  fullName: "Nguyen Linh La"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  bio: "Software developer"
                  gender: "MALE"
                  dateOfBirth: "1990-01-15T00:00:00.000Z"
                  location: "Ho Chi Minh City"
                  profileVisibility: "PUBLIC"
                  online: true
                  lastSeen: null
                  createdAt: "2025-01-01T00:00:00.000Z"
                  updatedAt: "2025-01-10T00:00:00.000Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-me001"

  /v1/auth/logout:
    post:
      summary: "Logout from current device"
      description: |
        Logout user khá»i device hiá»‡n táº¡i.
        
        **Actions:**
        - Mark user as offline
        - Invalidate current access token
        - Revoke associated refresh token
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Logged out successfully from this device."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Logged out from this device successfully"
                data: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-logout001"

  /v1/auth/logout-all:
    post:
      summary: "Logout from all devices"
      description: |
        Logout user khá»i táº¥t cáº£ devices.
        
        **Actions:**
        - Mark user as offline
        - Revoke all refresh tokens
        - All existing access tokens will be invalid after expiry
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Logged out successfully from all devices."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Logged out from all devices successfully"
                data: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-logoutall001"

  /v1/auth/change-password:
    put:
      summary: "Change password"
      description: |
        Thay Ä‘á»•i password cá»§a user hiá»‡n táº¡i.
        
        **Validation:**
        - Current password must be correct
        - New password must be different from current
        - New password minimum 6 characters
      tags: [Authentication]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ChangePasswordRequest' }
            example:
              currentPassword: "oldPassword123"
              newPassword: "newSecurePass456"
      responses:
        '200':
          description: "Password changed successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Password changed successfully"
                data: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                wrong_current_password:
                  summary: "Current password incorrect"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Current password is incorrect"
                    requestId: "req-changepw001"
                same_password:
                  summary: "New password same as current"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "New password must be different from current password"
                    requestId: "req-changepw002"
                password_too_short:
                  summary: "New password too short"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "newPassword"
                          code: "SIZE"
                          message: "New password must be at least 6 characters"
                    requestId: "req-changepw003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-changepw004"

  /v1/auth/verify-email:
    post:
      summary: "Verify email with OTP"
      description: |
        XÃ¡c thá»±c email sau khi Ä‘Äƒng kÃ½.
        
        **Flow:**
        1. User receives 6-digit OTP via email
        2. Submit email + OTP
        3. Email marked as verified
        4. User can now login
        
        **OTP:**
        - 6 digits
        - Valid for 10 minutes
        - Rate limit: 1 request per 5 minutes
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/VerifyEmailRequest' }
            example:
              email: "user@example.com"
              otp: "123456"
      responses:
        '200':
          description: "Email verified successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Email verified successfully. You can now login."
                data: null
        '400':
          description: "Bad Request - Invalid OTP or validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_otp:
                  summary: "Invalid or expired OTP"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Invalid or expired verification code"
                    requestId: "req-verify001"
                already_verified:
                  summary: "Email already verified"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Email already verified"
                    requestId: "req-verify002"
                invalid_otp_format:
                  summary: "OTP format invalid"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "otp"
                          code: "PATTERN"
                          message: "OTP must be 6 digits"
                    requestId: "req-verify003"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-verify004"
        '429':
          description: "Too Many Requests - Rate limit exceeded."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many verification attempts. Please try again later."
                requestId: "req-verify005"

  /v1/auth/resend-verification:
    post:
      summary: "Resend verification email"
      description: |
        Gá»­i láº¡i email verification vá»›i OTP má»›i.
        
        **Rate limit:** 3 requests per 10 minutes
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ResendVerificationRequest' }
            example:
              email: "user@example.com"
      responses:
        '200':
          description: "Verification email sent successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Verification email sent successfully"
                data: null
        '400':
          description: "Bad Request - Email already verified."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "Email already verified"
                requestId: "req-resend001"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-resend002"
        '429':
          description: "Too Many Requests - Rate limit exceeded."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many requests. Please try again later."
                requestId: "req-resend003"

  /v1/auth/forgot-password:
    post:
      summary: "Request password reset"
      description: |
        Gá»­i email vá»›i OTP Ä‘á»ƒ reset password.
        
        **Flow:**
        1. Submit email
        2. Receive 6-digit OTP via email
        3. Use OTP with /reset-password endpoint
        
        **Rate limit:** 3 requests per 10 minutes
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ForgotPasswordRequest' }
            example:
              email: "user@example.com"
      responses:
        '200':
          description: "Password reset email sent successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Password reset email sent successfully"
                data: null
        '404':
          description: "User not found (silently return 200 for security)."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Password reset email sent successfully"
                data: null
        '429':
          description: "Too Many Requests - Rate limit exceeded."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many requests. Please try again later."
                requestId: "req-forgot001"

  /v1/auth/reset-password:
    post:
      summary: "Reset password with OTP"
      description: |
        Reset password sá»­ dá»¥ng OTP tá»« email.
        
        **Flow:**
        1. User receives OTP from /forgot-password
        2. Submit email + OTP + new password
        3. Password is reset
        4. User can login with new password
        
        **Rate limit:** 1 request per 5 minutes
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ResetPasswordRequest' }
            example:
              email: "user@example.com"
              otp: "123456"
              newPassword: "newSecurePassword123"
      responses:
        '200':
          description: "Password reset successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Password reset successfully"
                data: null
        '400':
          description: "Bad Request - Invalid OTP or validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_otp:
                  summary: "Invalid or expired OTP"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Invalid or expired reset code"
                    requestId: "req-reset001"
                password_too_short:
                  summary: "Password too short"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "newPassword"
                          code: "SIZE"
                          message: "Password must be at least 6 characters"
                    requestId: "req-reset002"
                invalid_otp_format:
                  summary: "OTP format invalid"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "otp"
                          code: "PATTERN"
                          message: "OTP must be 6 digits"
                    requestId: "req-reset003"
                    requestId: "req-reset003"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-reset004"
        '429':
          description: "Too Many Requests - Rate limit exceeded."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RATE_LIMIT_EXCEEDED"
                  message: "Too many reset attempts. Please try again later."
                requestId: "req-reset005"

  /v1/users/search:
    get:
      summary: "Search users"
      description: |
        TÃ¬m kiáº¿m ngÆ°á»i dÃ¹ng theo username, email hoáº·c full name vá»›i phÃ¢n trang.
        
        **Search:** Case-insensitive partial match trÃªn username, email, fullName
        **Additional info:** Includes contact status and conversation info
        **Pagination:** Default 20 items per page
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: false
          schema:
            type: string
            default: ""
          description: "Search keyword (username, email, or name). Empty = all users"
          example: "nguyen"
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            default: 0
          description: "Page number (0-indexed)"
          example: 0
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 100
            default: 20
          description: "Number of items per page"
          example: 20
      responses:
        '200':
          description: "Users found successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    $ref: '#/components/schemas/PaginatedUserSearchResponse'
              example:
                success: true
                message: "Users found successfully"
                data:
                  data:
                    - id: 7
                      username: "lanbui"
                      email: "lanbui@gmail.com"
                      fullName: "Bui Thi Lan"
                      avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/7.png"
                      online: false
                      lastSeen: "2025-12-11T18:17:10.777888Z"
                      contact: false
                      hasConversation: false
                      conversationId: null
                    - id: 2
                      username: "user2"
                      email: "binhtran@gmail.com"
                      fullName: "Tran Van Binh"
                      avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/2.png"
                      online: false
                      lastSeen: "2025-12-14T06:12:27.806735Z"
                      contact: false
                      hasConversation: true
                      conversationId: 1
                    - id: 3
                      username: "hoale"
                      email: "hoale@gmail.com"
                      fullName: "Le Thi Hoa"
                      avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/3.png"
                      online: false
                      lastSeen: "2025-12-12T08:30:00Z"
                      contact: true
                      hasConversation: true
                      conversationId: 3
                  page: 0
                  size: 20
                  total: 19
                  totalPages: 1
                  hasNextPage: false
                  hasPrevPage: false
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-search002"

  /v1/users/status/batch:
    get:
      summary: "Get batch user status"
      description: |
        Láº¥y online status cá»§a nhiá»u users cÃ¹ng lÃºc.
        
        **Use case:** Update online status for contact list, conversation participants
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: userIds
          in: query
          required: true
          schema:
            type: string
          description: "Comma-separated user IDs"
          example: "1,5,10,15"
      responses:
        '200':
          description: "User statuses retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        userId: { type: integer, format: int64 }
                        online: { type: boolean }
                        lastSeen: { type: string, format: date-time, nullable: true }
              example:
                success: true
                message: "Statuses retrieved successfully"
                data:
                  - userId: 1
                    online: true
                    lastSeen: null
                  - userId: 5
                    online: false
                    lastSeen: "2025-12-14T08:30:00.000Z"
                  - userId: 10
                    online: true
                    lastSeen: null
        '400':
          description: "Bad Request - Invalid user IDs."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "userIds"
                      code: "NOT_NULL"
                      message: "User IDs parameter is required"
                requestId: "req-status001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-status002"

  /v1/users/status:
    put:
      summary: "Update user status manually"
      description: |
        Manually set online/offline status.
        
        **Note:** Usually automatic via WebSocket connect/disconnect.
        This endpoint for manual override.
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [online]
              properties:
                online:
                  type: boolean
                  description: "Set online or offline"
            example:
              online: true
      responses:
        '200':
          description: "Status updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Status updated successfully"
                data: null
        '400':
          description: "Bad Request - Invalid status value."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "online"
                      code: "NOT_NULL"
                      message: "Online field is required"
                requestId: "req-statusupd001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-statusupd002"

  /v1/profile/me:
    get:
      summary: "Get my profile"
      description: "Láº¥y thÃ´ng tin profile cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i."
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/UserResponse' }
              example:
                success: true
                message: "Profile retrieved successfully"
                data:
                  id: 1
                  username: "user1"
                  email: "user1@example.com"
                  emailVerified: true
                  phone: "+84987654321"
                  fullName: "Nguyen Linh La"
                  avatarUrl: "https://res.cloudinary.com/.../1.png"
                  bio: "Software Developer | Tech Enthusiast"
                  gender: "MALE"
                  dateOfBirth: "1995-05-15T00:00:00.000Z"
                  location: "Ho Chi Minh City, Vietnam"
                  profileVisibility: "PUBLIC"
                  online: true
                  lastSeen: null
                  createdAt: "2025-01-01T00:00:00.000Z"
                  updatedAt: "2025-01-08T00:00:00.000Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-profile001"
    put:
      summary: "Update my profile"
      description: |
        Cáº­p nháº­t thÃ´ng tin profile cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i.
        
        **Updatable fields:** fullName, avatarUrl, phone, bio, dateOfBirth, gender, location, profileVisibility
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateProfileRequest' }
            examples:
              update_name:
                summary: "Update full name"
                value:
                  fullName: "Nguyen Van New Name"
              update_avatar:
                summary: "Update avatar"
                value:
                  avatarUrl: "https://res.cloudinary.com/.../new-avatar.png"
              update_bio:
                summary: "Update bio"
                value:
                  bio: "Full-stack developer with passion for AI"
              update_all:
                summary: "Update multiple fields"
                value:
                  fullName: "Nguyen Van New Name"
                  avatarUrl: "https://res.cloudinary.com/.../new-avatar.png"
                  bio: "Full-stack developer"
                  phone: "+84987654321"
                  gender: "MALE"
                  location: "Hanoi, Vietnam"
                  profileVisibility: "FRIENDS_ONLY"
      responses:
        '200':
          description: "Profile updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/UserResponse' }
              example:
                success: true
                message: "Profile updated successfully"
                data:
                  id: 1
                  username: "user1"
                  email: "user1@example.com"
                  emailVerified: true
                  phone: "+84987654321"
                  fullName: "Nguyen Van New Name"
                  avatarUrl: "https://res.cloudinary.com/.../new-avatar.png"
                  bio: "Full-stack developer"
                  gender: "MALE"
                  dateOfBirth: "1995-05-15T00:00:00.000Z"
                  location: "Hanoi, Vietnam"
                  profileVisibility: "FRIENDS_ONLY"
                  online: true
                  lastSeen: null
                  createdAt: "2025-01-01T00:00:00.000Z"
                  updatedAt: "2025-01-10T10:30:00.000Z"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_fullname:
                  summary: "Full name too long"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "fullName"
                          code: "SIZE"
                          message: "Full name must be between 1 and 100 characters"
                    requestId: "req-profileupd001"
                invalid_bio:
                  summary: "Bio too long"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "bio"
                          code: "SIZE"
                          message: "Bio must not exceed 500 characters"
                    requestId: "req-profileupd002"
                invalid_avatar_url:
                  summary: "Invalid avatar URL"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "avatarUrl"
                          code: "URL"
                          message: "Avatar URL must be valid"
                    requestId: "req-profileupd003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-profileupd004"

  /v1/profile/{userId}:
    get:
      summary: "Get user profile by ID"
      description: "Láº¥y thÃ´ng tin profile cá»§a má»™t ngÆ°á»i dÃ¹ng cá»¥ thá»ƒ."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "User ID"
          example: 5
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/UserResponse' }
              example:
                success: true
                message: "Profile retrieved successfully"
                data:
                  id: 5
                  username: "user5"
                  email: "user5@example.com"
                  fullName: "Nguyen Van A"
                  avatarUrl: "https://res.cloudinary.com/.../5.png"
                  online: false
                  lastSeen: "2025-12-14T08:30:00.000Z"
                  emailVerified: true
                  createdAt: "2025-01-05T00:00:00.000Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-profileget001"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-profileget002"

  /v1/profile/username/{username}:
    get:
      summary: "Get user profile by username"
      description: "Láº¥y thÃ´ng tin profile cá»§a ngÆ°á»i dÃ¹ng theo username."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema: { type: string }
          description: "Username"
          example: "user5"
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/UserResponse' }
              example:
                success: true
                message: "Profile retrieved successfully"
                data:
                  id: 5
                  username: "user5"
                  email: "user5@example.com"
                  fullName: "Nguyen Van A"
                  avatarUrl: "https://res.cloudinary.com/.../5.png"
                  online: false
                  lastSeen: "2025-12-14T08:30:00.000Z"
                  emailVerified: true
                  createdAt: "2025-01-05T00:00:00.000Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-profileusername001"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-profileusername002"

  # --- User Notes Paths ---
  /v1/notes:
    post:
      summary: "Create or update note"
      description: |
        Táº¡o hoáº·c cáº­p nháº­t note (status) cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i.
        
        **Rules:**
        - Má»—i user chá»‰ cÃ³ 1 note active táº¡i má»™t thá»i Ä‘iá»ƒm
        - Note tá»± Ä‘á»™ng expire sau 24 giá»
        - Tá»‘i Ä‘a 60 kÃ½ tá»±
        - Emoji optional
      tags: [User Notes]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [noteText]
              properties:
                noteText:
                  type: string
                  maxLength: 60
                  description: "Note content (max 60 chars)"
                emoji:
                  type: string
                  nullable: true
                  description: "Optional emoji"
            examples:
              with_emoji:
                summary: "Note with emoji"
                value:
                  noteText: "Feeling great today!"
                  emoji: "ğŸ˜Š"
              without_emoji:
                summary: "Note without emoji"
                value:
                  noteText: "Working on new project"
      responses:
        '200':
          description: "Note created/updated successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/UserNoteResponse' }
              example:
                success: true
                message: "Note created successfully"
                data:
                  id: 15
                  userId: 1
                  noteText: "Feeling great today!"
                  emoji: "ğŸ˜Š"
                  createdAt: "2025-12-14T10:00:00.000Z"
                  expiresAt: "2025-12-15T10:00:00.000Z"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                text_too_long:
                  summary: "Note text too long"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "noteText"
                          code: "SIZE"
                          message: "Note text must not exceed 60 characters"
                    requestId: "req-note001"
                text_empty:
                  summary: "Note text empty"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "noteText"
                          code: "NOT_BLANK"
                          message: "Note text cannot be blank"
                    requestId: "req-note002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-note003"
    get:
      summary: "Get my current note"
      description: "Láº¥y note hiá»‡n táº¡i cá»§a ngÆ°á»i dÃ¹ng."
      tags: [User Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    oneOf:
                      - $ref: '#/components/schemas/UserNoteResponse'
                      - type: object
                        nullable: true
              examples:
                has_note:
                  summary: "User has active note"
                  value:
                    success: true
                    message: "Note retrieved successfully"
                    data:
                      id: 15
                      userId: 1
                      noteText: "Feeling great today!"
                      emoji: "ğŸ˜Š"
                      createdAt: "2025-12-14T10:00:00.000Z"
                      expiresAt: "2025-12-15T10:00:00.000Z"
                no_note:
                  summary: "User has no note"
                  value:
                    success: true
                    message: "No active note"
                    data: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-noteget001"
    delete:
      summary: "Delete my note"
      description: "XÃ³a note hiá»‡n táº¡i cá»§a ngÆ°á»i dÃ¹ng."
      tags: [User Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note deleted successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { type: object, nullable: true }
              example:
                success: true
                message: "Note deleted successfully"
                data: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-notedel001"
        '404':
          description: "Note not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Note not found"
                requestId: "req-notedel002"

  /v1/notes/contacts:
    get:
      summary: "Get notes from contacts"
      description: |
        Láº¥y danh sÃ¡ch notes cá»§a táº¥t cáº£ contacts.
        
        **Use case:** Display notes/statuses in contact list
      tags: [User Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Contact notes retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserNoteResponse'
              example:
                success: true
                message: "Contact notes retrieved successfully"
                data:
                  - id: 15
                    userId: 5
                    noteText: "On vacation ğŸ–ï¸"
                    emoji: "ğŸ–ï¸"
                    createdAt: "2025-12-14T10:00:00.000Z"
                    expiresAt: "2025-12-15T10:00:00.000Z"
                  - id: 18
                    userId: 10
                    noteText: "Busy with meetings"
                    emoji: "ğŸ“…"
                    createdAt: "2025-12-14T09:00:00.000Z"
                    expiresAt: "2025-12-15T09:00:00.000Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-contactnotes001"

  /v1/notes/user/{userId}:
    get:
      summary: "Get note of specific user"
      description: "Láº¥y note cá»§a má»™t user cá»¥ thá»ƒ."
      tags: [User Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "User ID"
          example: 5
      responses:
        '200':
          description: "User note retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    oneOf:
                      - $ref: '#/components/schemas/UserNoteResponse'
                      - type: object
                        nullable: true
              examples:
                has_note:
                  summary: "User has note"
                  value:
                    success: true
                    message: "Note retrieved successfully"
                    data:
                      id: 15
                      userId: 5
                      noteText: "On vacation ğŸ–ï¸"
                      emoji: "ğŸ–ï¸"
                      createdAt: "2025-12-14T10:00:00.000Z"
                      expiresAt: "2025-12-15T10:00:00.000Z"
                no_note:
                  summary: "User has no note"
                  value:
                    success: true
                    message: "No active note"
                    data: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-usernote001"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-usernote002"

  # --- Conversation Paths ---
  /v1/conversations:
    post:
      summary: "Create a new conversation"
      description: |
        Táº¡o má»™t cuá»™c trÃ² chuyá»‡n má»›i (1-1 hoáº·c nhÃ³m).
        
        **VALIDATION RULES:**
        - **DIRECT**: PHáº¢I cÃ³ Ä‘Ãºng 1 participant khÃ¡c (ngoÃ i current user)
          - âŒ WRONG: participantIds: [17, 18, 19] (3 ngÆ°á»i)
          - âœ… CORRECT: participantIds: [17] (1 ngÆ°á»i)
          
        - **GROUP**: PHáº¢I cÃ³ Ã­t nháº¥t 1 participant khÃ¡c (ngoÃ i current user)
          - âœ… CORRECT: participantIds: [17, 18] (2+ ngÆ°á»i)
          - âœ… CORRECT: participantIds: [17] (1 ngÆ°á»i, nhÆ°ng nÃªn dÃ¹ng DIRECT thay vÃ¬ GROUP)
        
        **Note**: Current user tá»± Ä‘á»™ng Ä‘Æ°á»£c thÃªm vÃ o conversation, khÃ´ng cáº§n Ä‘Æ°a vÃ o participantIds.
      tags: [Conversations]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateConversationRequest' }
            examples:
              direct:
                summary: "Direct conversation (1-1) - CORRECT"
                value:
                  type: "DIRECT"
                  participantIds: [17]
              direct_wrong:
                summary: "Direct conversation - WRONG (multiple participants)"
                value:
                  type: "DIRECT"
                  participantIds: [17, 18, 19]
              group:
                summary: "Group conversation - CORRECT"
                value:
                  name: "Team Chat"
                  type: "GROUP"
                  participantIds: [17, 18, 19]
      responses:
        '201':
          description: "Conversation created successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation created successfully"
                data:
                  id: 7
                  type: "DIRECT"
                  createdAt: "2025-12-14T06:50:02.634141682Z"
                  updatedAt: "2025-12-14T06:50:02.634143143Z"
                  participants:
                    - userId: 1
                      username: "user1"
                      role: "ADMIN"
                    - userId: 15
                      username: "sontrinh"
                      role: "MEMBER"
        '400':
          description: |
            Bad Request - Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                direct_multiple_participants:
                  summary: "DIRECT conversation with multiple participants"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "DIRECT conversation must have exactly 1 other participant. Found: 3"
                    requestId: "req-abc123"
                no_participants:
                  summary: "No participants provided"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "At least one participant is required"
                    requestId: "req-def456"
                participant_not_found:
                  summary: "Participant user not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Participant not found: 99999"
                    requestId: "req-ghi789"
                conversation_exists:
                  summary: "Conversation already exists (DIRECT)"
                  value:
                    success: false
                    error:
                      code: "CONFLICT"
                      message: "A conversation with this user already exists"
                    requestId: "req-jkl012"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-mno345"
    get:
      summary: "Get all conversations"
      description: "Láº¥y danh sÃ¡ch táº¥t cáº£ cuá»™c trÃ² chuyá»‡n cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i, sáº¯p xáº¿p theo tin nháº¯n má»›i nháº¥t. Há»— trá»£ filter theo loáº¡i conversation vÃ  phÃ¢n trang."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: filter
          in: query
          required: false
          description: |
            Filter conversations by type:
            - **all** (default): Táº¥t cáº£ conversations
            - **unread**: Chá»‰ conversations cÃ³ tin nháº¯n chÆ°a Ä‘á»c
            - **group**: Chá»‰ conversations nhÃ³m (GROUP)
          schema:
            type: string
            enum: [all, unread, group]
            default: all
          example: all
        - name: page
          in: query
          required: false
          description: "Page number (0-indexed)"
          schema:
            type: integer
            format: int32
            minimum: 0
            default: 0
          example: 0
        - name: size
          in: query
          required: false
          description: "Number of items per page"
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 100
            default: 20
          example: 20
      responses:
        '200':
          description: "Conversations retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationListResponse' }
              examples:
                all:
                  summary: "All conversations (filter=all) with pagination"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      data:
                        - id: 1
                          type: "DIRECT"
                          createdAt: "2025-12-12T09:35:09.382687Z"
                          updatedAt: "2025-12-13T07:38:26.471576Z"
                          participants:
                            - userId: 12
                              username: "hungly"
                              role: "ADMIN"
                            - userId: 17
                              username: "ducphan"
                              role: "MEMBER"
                          lastMessage:
                            id: 6
                            content: "Ä‘Ã£ sá»­a nha"
                            senderId: 12
                            senderUsername: "hungly"
                            sentAt: "2025-12-13T07:38:26.438210Z"
                            type: "TEXT"
                        - id: 5
                          type: "GROUP"
                          createdAt: "2025-12-12T09:39:16.600310Z"
                          updatedAt: "2025-12-12T09:39:16.600313Z"
                          participants:
                            - userId: 12
                              username: "hungly"
                              role: "ADMIN"
                            - userId: 3
                              username: "hoale"
                              role: "MEMBER"
                            - userId: 4
                              username: "tuanpham"
                              role: "MEMBER"
                            - userId: 2
                              username: "binhtran"
                              role: "MEMBER"
                            - userId: 5
                              username: "thuyvo"
                              role: "MEMBER"
                        - id: 4
                          type: "DIRECT"
                          createdAt: "2025-12-12T09:38:52.749391Z"
                          updatedAt: "2025-12-12T09:38:52.749395Z"
                          participants:
                            - userId: 12
                              username: "hungly"
                              role: "ADMIN"
                            - userId: 17
                              username: "ducphan"
                              role: "MEMBER"
                      page: 0
                      size: 20
                      total: 3
                      totalPages: 1
                      hasNextPage: false
                      hasPrevPage: false
                unread:
                  summary: "Only unread conversations (filter=unread)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      data:
                        - id: 1
                          type: "DIRECT"
                          createdAt: "2025-12-12T09:35:09.382687Z"
                          updatedAt: "2025-12-13T07:38:26.471576Z"
                          participants:
                            - userId: 12
                              username: "hungly"
                              role: "ADMIN"
                            - userId: 17
                              username: "ducphan"
                              role: "MEMBER"
                          lastMessage:
                            id: 6
                            content: "Ä‘Ã£ sá»­a nha"
                            senderId: 12
                            senderUsername: "hungly"
                            sentAt: "2025-12-13T07:38:26.438210Z"
                            type: "TEXT"
                      page: 0
                      size: 20
                      total: 1
                      totalPages: 1
                      hasNextPage: false
                      hasPrevPage: false
                group:
                  summary: "Only group conversations (filter=group)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      data:
                        - id: 5
                          type: "GROUP"
                          createdAt: "2025-12-12T09:39:16.600310Z"
                          updatedAt: "2025-12-12T09:39:16.600313Z"
                          participants:
                            - userId: 12
                              username: "hungly"
                              role: "ADMIN"
                            - userId: 3
                              username: "hoale"
                              role: "MEMBER"
                            - userId: 4
                              username: "tuanpham"
                              role: "MEMBER"
                            - userId: 2
                              username: "binhtran"
                              role: "MEMBER"
                            - userId: 5
                              username: "thuyvo"
                              role: "MEMBER"
                      page: 0
                      size: 20
                      total: 1
                      totalPages: 1
                      hasNextPage: false
                      hasPrevPage: false
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"

  /v1/conversations/{conversationId}:
    get:
      summary: "Get a conversation"
      description: "Láº¥y thÃ´ng tin chi tiáº¿t cá»§a má»™t cuá»™c trÃ² chuyá»‡n, bao gá»“m participants vÃ  last message."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 1
      responses:
        '200':
          description: "Conversation retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation retrieved successfully"
                data:
                  id: 1
                  type: "DIRECT"
                  createdAt: "2025-12-12T09:35:09.382687Z"
                  updatedAt: "2025-12-13T07:38:26.471576Z"
                  participants:
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 17
                      username: "ducphan"
                      role: "MEMBER"
                  lastMessage:
                    id: 6
                    content: "Ä‘Ã£ sá»­a nha"
                    senderId: 12
                    senderUsername: "hungly"
                    sentAt: "2025-12-13T07:38:26.438210Z"
                    type: "TEXT"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You do not have access to this conversation"
                requestId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "783376db-aad3-4ae8-9886-9074a79356d0"
    put:
      summary: "Update a conversation"
      description: |
        Cáº­p nháº­t thÃ´ng tin cuá»™c trÃ² chuyá»‡n (tÃªn, avatar).
        - Chá»‰ admin má»›i Ä‘Æ°á»£c cáº­p nháº­t trong group chat
        - KhÃ´ng thá»ƒ update direct conversation
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateConversationRequest' }
            example:
              name: "day la group"
              avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
      responses:
        '200':
          description: "Conversation updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation updated successfully"
                data:
                  id: 7
                  type: "GROUP"
                  name: "day la group"
                  avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
                  createdAt: "2025-12-13T09:14:14.522996Z"
                  updatedAt: "2025-12-13T09:14:14.522999Z"
                  participants:
                    - userId: 5
                      username: "thuyvo"
                      role: "MEMBER"
                    - userId: 4
                      username: "tuanpham"
                      role: "MEMBER"
                    - userId: 6
                      username: "thanhdang"
                      role: "MEMBER"
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 2
                      username: "binhtran"
                      role: "MEMBER"
                    - userId: 3
                      username: "hoale"
                      role: "MEMBER"
        '400':
          description: "Bad Request - Validation failed or no access."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "b1c2d3e4-f5a6-7890-bcde-f12345678901"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '403':
          description: "Forbidden - Only admin can update."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "FORBIDDEN" }
                      message: { type: string, example: "Only admin can update group conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "Only admin can update group conversation"
                requestId: "c2d3e4f5-a6b7-8901-cdef-234567890abc"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "d3e4f5a6-b7c8-9012-def0-34567890abcd"
    delete:
      summary: "Delete a conversation"
      description: |
        XÃ³a má»™t cuá»™c trÃ² chuyá»‡n (user rá»i khá»i conversation).
        - User sáº½ bá»‹ remove khá»i participants list
        - CÃ³ thá»ƒ Ã¡p dá»¥ng cho cáº£ DIRECT vÃ  GROUP conversation
        - Conversation váº«n tá»“n táº¡i cho cÃ¡c participants khÃ¡c
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      responses:
        '200':
          description: "Conversation deleted successfully (user left the conversation)."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Conversation deleted successfully" }
              example:
                success: true
                message: "Conversation deleted successfully"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "e4f5a6b7-c8d9-0123-ef01-4567890abcde"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "f5a6b7c8-d9e0-1234-f012-567890abcdef"

  # --- Message Paths ---
  /v1/conversations/{conversationId}/messages:
    get:
      summary: "Get conversation messages"
      description: "Láº¥y danh sÃ¡ch tin nháº¯n trong má»™t cuá»™c trÃ² chuyá»‡n, cÃ³ há»— trá»£ phÃ¢n trang."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: "Sá»‘ trang (báº¯t Ä‘áº§u tá»« 0)."
        - name: size
          in: query
          schema:
            type: integer
            default: 50
          description: "KÃ­ch thÆ°á»›c trang."
        - name: sort
          in: query
          schema:
            type: string
            default: "DESC"
            enum: [ASC, DESC]
          description: "Thá»© tá»± sáº¯p xáº¿p theo thá»i gian."
      responses:
        '200':
          description: "Messages retrieved successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageListResponse'
              example:
                success: true
                message: "Messages retrieved successfully"
                data:
                  - id: 8
                    conversationId: 1
                    senderId: 2
                    senderUsername: "user2"
                    senderFullName: "Tran Van Binh"
                    content: "Tao pháº£i Ä‘á»¡ cho em tao"
                    type: "TEXT"
                    reactions: {}
                    sentAt: "2025-12-14T06:29:24.691046Z"
                    createdAt: "2025-12-14T06:29:24.691048Z"
                    updatedAt: "2025-12-14T06:29:24.691049Z"
                    edited: false
                    deleted: false
                    forwarded: false
                    forwardCount: 0
                    readCount: 0
                  - id: 5
                    conversationId: 1
                    senderId: 2
                    senderUsername: "user2"
                    senderFullName: "Tran Van Binh"
                    content: "HÃ¬ hÃ¬ Ä‘Ãºng tháº­t, cÅ©ng Ä‘Ã£ nhiá»u nÄƒm trÃ´i qua"
                    type: "TEXT"
                    reactions: {}
                    sentAt: "2025-12-14T06:18:25.432835Z"
                    createdAt: "2025-12-14T06:18:25.432836Z"
                    updatedAt: "2025-12-14T06:18:25.432837Z"
                    edited: false
                    deleted: false
                    forwarded: false
                    forwardCount: 0
                    readCount: 1
                    readBy:
                      - userId: 1
                        username: "user1"
                        fullName: "Nguyen Linh La"
                        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                        readAt: "2025-12-14T06:50:24.557Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-msgs001"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-msgs002"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-msgs003"
    post:
      summary: "Send a message"
      description: "Gá»­i má»™t tin nháº¯n má»›i vÃ o cuá»™c trÃ² chuyá»‡n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatMessageRequest'
      responses:
        '201':
          description: "Message sent successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageResponse'
              example:
                success: true
                message: "Message sent successfully"
                data:
                  id: 25
                  conversationId: 1
                  senderId: 1
                  senderUsername: "user1"
                  senderFullName: "Nguyen Linh La"
                  content: "Hello, how are you?"
                  type: "TEXT"
                  reactions: {}
                  sentAt: "2025-12-14T06:53:17.372188410Z"
                  createdAt: "2025-12-14T06:53:17.372191027Z"
                  updatedAt: "2025-12-14T06:53:17.372191325Z"
                  edited: false
                  deleted: false
                  forwarded: false
                  forwardCount: 0
                  readCount: 0
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                empty_content:
                  summary: "Empty message content"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "content"
                          code: "NOT_BLANK"
                          message: "Content is required"
                    requestId: "req-msg001"
                invalid_reply:
                  summary: "Reply to non-existent message"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Reply message not found: 99999"
                    requestId: "req-msg002"
                invalid_mentions:
                  summary: "Mention non-existent user"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "mentionedUserIds"
                          code: "VALID_USER_IDS"
                          message: "Mentioned user not found: 88888"
                    requestId: "req-msg003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-msg004"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-msg005"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-msg006"

  /v1/conversations/{conversationId}/messages/{messageId}:
    get:
      summary: "Get a specific message"
      description: "Láº¥y thÃ´ng tin chi tiáº¿t cá»§a má»™t tin nháº¯n cá»¥ thá»ƒ."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
              example:
                success: true
                message: "Message retrieved successfully"
                data:
                  id: 5
                  conversationId: 1
                  senderId: 2
                  senderUsername: "user2"
                  senderFullName: "Tran Van Binh"
                  content: "HÃ¬ hÃ¬ Ä‘Ãºng tháº­t, cÅ©ng Ä‘Ã£ nhiá»u nÄƒm trÃ´i qua"
                  type: "TEXT"
                  reactions: {}
                  sentAt: "2025-12-14T06:18:25.432835Z"
                  createdAt: "2025-12-14T06:18:25.432836Z"
                  updatedAt: "2025-12-14T06:18:25.432837Z"
                  edited: false
                  deleted: false
                  forwarded: false
                  forwardCount: 0
                  readCount: 1
                  readBy:
                    - userId: 1
                      username: "user1"
                      fullName: "Nguyen Linh La"
                      avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                      readAt: "2025-12-14T06:50:24.557Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getmsg001"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-getmsg002"
        '404':
          description: "Message or Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                message_not_found:
                  summary: "Message not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Message not found"
                    requestId: "req-getmsg003"
                conversation_not_found:
                  summary: "Conversation not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Conversation not found"
                    requestId: "req-getmsg004"
    put:
      summary: "Update a message"
      description: "Cáº­p nháº­t ná»™i dung cá»§a má»™t tin nháº¯n Ä‘Ã£ gá»­i. Chá»‰ ngÆ°á»i gá»­i má»›i cÃ³ thá»ƒ sá»­a tin nháº¯n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateMessageRequest' }
      responses:
        '200':
          description: "Message updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
              example:
                success: true
                message: "Message edited successfully"
                data:
                  id: 3
                  conversationId: 1
                  senderId: 1
                  senderUsername: "user1"
                  senderFullName: "Nguyen Linh La"
                  content: "da thay doi"
                  type: "TEXT"
                  sentAt: "2025-12-14T06:10:21.019500Z"
                  edited: true
                  editedAt: "2025-12-14T06:51:40.617582834Z"
                  deleted: false
                  forwarded: false
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                empty_content:
                  summary: "Empty message content"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "content"
                          code: "NOT_BLANK"
                          message: "Content is required"
                    requestId: "req-editmsg001"
                message_deleted:
                  summary: "Cannot edit deleted message"
                  value:
                    success: false
                    error:
                      code: "BUSINESS_ERROR"
                      message: "Cannot edit a deleted message"
                    requestId: "req-editmsg002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-editmsg003"
        '403':
          description: "Forbidden - Not the message sender."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You can only edit your own messages"
                requestId: "req-editmsg004"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-editmsg005"
    delete:
      summary: "Delete a message"
      description: "XÃ³a má»™t tin nháº¯n Ä‘Ã£ gá»­i. Chá»‰ ngÆ°á»i gá»­i má»›i cÃ³ thá»ƒ xÃ³a tin nháº¯n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Message deleted successfully"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-delmsg001"
        '403':
          description: "Forbidden - Not the message sender."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You can only delete your own messages"
                requestId: "req-delmsg002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-delmsg003"

  # --- Message Reactions ---
  /v1/messages/{messageId}/reactions:
    post:
      summary: "Add or toggle reaction"
      description: "ThÃªm hoáº·c toggle reaction (emoji) vÃ o tin nháº¯n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddReactionRequest' }
      responses:
        '200':
          description: "Reaction toggled successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reaction toggled successfully"
                data:
                  messageId: 1
                  reactions:
                    "ğŸ˜€":
                      - 1
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Validation failed"
                  details:
                    - field: "emoji"
                      code: "NOT_BLANK"
                      message: "Emoji is required"
                requestId: "req-react001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-react002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-react003"
    get:
      summary: "Get message reactions"
      description: "Láº¥y táº¥t cáº£ reactions cá»§a má»™t tin nháº¯n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Reactions retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reactions retrieved successfully"
                data:
                  messageId: 1
                  reactions:
                    "ğŸ˜€":
                      - 1
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getreact001"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-getreact002"

  /v1/messages/{messageId}/reactions/{emoji}:
    delete:
      summary: "Remove reaction"
      description: "XÃ³a reaction cá»§a user hiá»‡n táº¡i khá»i tin nháº¯n."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: emoji
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: "Reaction removed successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reaction removed successfully"
                data:
                  messageId: 1
                  reactions: {}
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-delreact001"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-delreact002"

  # --- Read Receipts ---
  /v1/read-receipts/messages/{messageId}:
    post:
      summary: "Mark message as read"
      description: "ÄÃ¡nh dáº¥u má»™t tin nháº¯n cá»¥ thá»ƒ lÃ  Ä‘Ã£ Ä‘á»c. Tá»± Ä‘á»™ng táº¡o read receipt."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a tin nháº¯n cáº§n Ä‘Ã¡nh dáº¥u Ä‘Ã£ Ä‘á»c"
      responses:
        '204':
          description: "Message marked as read successfully (no content)."
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-read001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-read002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-read003"
    get:
      summary: "Get read receipts for message"
      description: "Láº¥y danh sÃ¡ch ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘á»c tin nháº¯n nÃ y, bao gá»“m thá»i gian Ä‘á»c."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a tin nháº¯n"
      responses:
        '200':
          description: "Read receipts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ReadReceiptListResponse' }
              example:
                success: true
                message: "Read receipts retrieved successfully"
                data:
                  - userId: 1
                    username: "user1"
                    fullName: "Nguyen Linh La"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    readAt: "2025-12-14T06:50:24.557Z"
                  - userId: 3
                    username: "hoale"
                    fullName: "Le Thi Hoa"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/3.png"
                    readAt: "2025-12-14T07:15:30.123Z"
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-getread001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getread002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-getread003"

  /v1/read-receipts/conversations/{conversationId}:
    post:
      summary: "Mark conversation as read"
      description: |
        ÄÃ¡nh dáº¥u táº¥t cáº£ tin nháº¯n trong conversation lÃ  Ä‘Ã£ Ä‘á»c.
        
        **Features:**
        - Táº¡o read receipts cho táº¥t cáº£ tin nháº¯n chÆ°a Ä‘á»c
        - Bá» qua tin nháº¯n cá»§a chÃ­nh user
        - Bá» qua tin nháº¯n Ä‘Ã£ Ä‘á»c rá»“i
        - Reset unread count trong participant table
        - CÃ³ thá»ƒ chá»‰ Ä‘á»‹nh lastMessageId Ä‘á»ƒ chá»‰ Ä‘Ã¡nh dáº¥u Ä‘áº¿n tin nháº¯n Ä‘Ã³
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a conversation"
        - name: lastMessageId
          in: query
          required: false
          schema: { type: integer, format: int64 }
          description: "ID cá»§a tin nháº¯n cuá»‘i cÃ¹ng cáº§n Ä‘Ã¡nh dáº¥u Ä‘Ã£ Ä‘á»c. Náº¿u khÃ´ng cÃ³, sáº½ Ä‘Ã¡nh dáº¥u táº¥t cáº£."
      responses:
        '204':
          description: "Conversation marked as read successfully (no content)."
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-convread001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-convread002"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-convread003"

  /v1/read-receipts/unread-count:
    get:
      summary: "Get global unread count"
      description: |
        Láº¥y tá»•ng sá»‘ tin nháº¯n chÆ°a Ä‘á»c tá»« táº¥t cáº£ conversations cá»§a user hiá»‡n táº¡i.
        
        **Use case:** Badge notification trÃªn app icon hoáº·c tab.
      tags: [Messages]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Unread count retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Unread count retrieved" }
                  data:
                    type: object
                    properties:
                      unreadCount: { type: integer, format: int64, description: "Total unread messages across all conversations" }
              example:
                success: true
                message: "Unread count retrieved"
                data:
                  unreadCount: 15
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-unread001"

  # --- Call Paths ---
  /v1/calls/initiate:
    post:
      summary: "Initiate a new call"
      description: |
        Báº¯t Ä‘áº§u má»™t cuá»™c gá»i Ä‘áº¿n má»™t ngÆ°á»i dÃ¹ng khÃ¡c.
        
        **Flow:**
        1. Validate cáº£ caller vÃ  callee khÃ´ng busy
        2. Táº¡o Call record vá»›i status RINGING
        3. Generate Agora token cho caller
        4. Send WebSocket invitation tá»›i callee
        5. Schedule timeout (30s)
        
        **Note:** User ID cá»§a caller Ä‘Æ°á»£c láº¥y tá»« JWT token.
      tags: [Call]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InitiateCallRequest' }
            examples:
              audio_call:
                summary: "Audio call"
                value:
                  calleeId: 10
                  callType: "AUDIO"
              video_call:
                summary: "Video call"
                value:
                  calleeId: 15
                  callType: "VIDEO"
      responses:
        '201':
          description: "Call initiated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
              example:
                success: true
                message: "Call initiated"
                data:
                  callInfo:
                    id: "call-uuid-123"
                    channelId: "channel_1734160800000_1_10"
                    status: "RINGING"
                    callType: "VIDEO"
                    callerId: 1
                    callerName: "Nguyen Linh La"
                    callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    calleeId: 10
                    calleeName: "Nguyen Van A"
                    calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    createdAt: "2025-12-14T10:00:00.000Z"
                    durationSeconds: null
                  token: "agora_token_here_for_caller"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                user_busy:
                  summary: "User is busy"
                  value:
                    success: false
                    error:
                      code: "USER_BUSY"
                      message: "User is busy in another call"
                    requestId: "req-call001"
                missing_callee_id:
                  summary: "Missing calleeId"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "calleeId"
                          code: "NOT_NULL"
                          message: "Callee ID is required"
                    requestId: "req-call002"
                missing_call_type:
                  summary: "Missing callType"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "callType"
                          code: "NOT_NULL"
                          message: "Call type is required"
                    requestId: "req-call003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-call004"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-call005"

  /v1/calls/{callId}/accept:
    post:
      summary: "Accept a call"
      description: |
        NgÆ°á»i nháº­n cháº¥p nháº­n má»™t cuá»™c gá»i Ä‘áº¿n.
        
        **Flow:**
        1. Validate user lÃ  callee
        2. Validate call status lÃ  RINGING
        3. Update status = CONNECTED
        4. Cancel timeout scheduler
        5. Generate Agora token cho callee
        6. Send WebSocket notification tá»›i caller
        
        **Note:** Chá»‰ callee má»›i cÃ³ thá»ƒ accept call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID cá»§a call"
          example: "call-uuid-123"
      responses:
        '200':
          description: "Call accepted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
              example:
                success: true
                message: "Call accepted"
                data:
                  callInfo:
                    id: "call-uuid-123"
                    channelId: "channel_1734160800000_1_10"
                    status: "CONNECTED"
                    callType: "VIDEO"
                    callerId: 1
                    callerName: "Nguyen Linh La"
                    callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    calleeId: 10
                    calleeName: "Nguyen Van A"
                    calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    createdAt: "2025-12-14T10:00:00.000Z"
                    durationSeconds: null
                  token: "agora_token_here_for_callee"
        '400':
          description: "Bad Request - Invalid status."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "INVALID_STATUS"
                  message: "Call is not ringing"
                requestId: "req-accept001"
        '401':
          description: "Unauthorized - Not the callee or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_callee:
                  summary: "Not the callee"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Only callee can accept this call"
                    requestId: "req-accept002"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-accept003"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-accept004"

  /v1/calls/{callId}/reject:
    post:
      summary: "Reject a call"
      description: |
        NgÆ°á»i nháº­n tá»« chá»‘i má»™t cuá»™c gá»i Ä‘áº¿n.
        
        **Flow:**
        1. Validate user lÃ  callee
        2. Validate call status lÃ  RINGING
        3. Update status = REJECTED
        4. Cancel timeout scheduler
        5. Send WebSocket notification tá»›i caller
        
        **Reasons:** busy, declined, unavailable
        
        **Note:** Chá»‰ callee má»›i cÃ³ thá»ƒ reject call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID cá»§a call"
          example: "call-uuid-123"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RejectCallRequest' }
            examples:
              busy:
                summary: "User is busy"
                value:
                  reason: "busy"
              declined:
                summary: "User declined"
                value:
                  reason: "declined"
              unavailable:
                summary: "User unavailable"
                value:
                  reason: "unavailable"
      responses:
        '200':
          description: "Call rejected successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
              example:
                success: true
                message: "Call rejected"
                data:
                  id: "call-uuid-123"
                  channelId: "channel_1734160800000_1_10"
                  status: "REJECTED"
                  callType: "VIDEO"
                  callerId: 1
                  callerName: "Nguyen Linh La"
                  callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  calleeId: 10
                  calleeName: "Nguyen Van A"
                  calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  createdAt: "2025-12-14T10:00:00.000Z"
                  durationSeconds: null
        '400':
          description: "Bad Request - Invalid status or reason."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_status:
                  summary: "Call not ringing"
                  value:
                    success: false
                    error:
                      code: "INVALID_STATUS"
                      message: "Cannot reject call"
                    requestId: "req-reject001"
                invalid_reason:
                  summary: "Invalid reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "reason"
                          code: "PATTERN"
                          message: "Reason must be one of: busy, declined, unavailable"
                    requestId: "req-reject002"
                missing_reason:
                  summary: "Missing reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "reason"
                          code: "NOT_BLANK"
                          message: "Reason cannot be blank"
                    requestId: "req-reject003"
        '401':
          description: "Unauthorized - Not the callee or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_callee:
                  summary: "Not the callee"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Only callee can reject this call"
                    requestId: "req-reject004"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-reject005"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-reject006"

  /v1/calls/{callId}/end:
    post:
      summary: "End a call"
      description: |
        Má»™t trong hai bÃªn káº¿t thÃºc cuá»™c gá»i.
        
        **Flow:**
        1. Validate user lÃ  caller hoáº·c callee
        2. Validate call chÆ°a ended
        3. Update status = ENDED
        4. Calculate duration
        5. Cancel timeout scheduler
        6. Send WebSocket notification tá»›i partner
        
        **Reasons:** hangup (default), network error, device error, timeout
        
        **Note:** Cáº£ caller vÃ  callee Ä‘á»u cÃ³ thá»ƒ end call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID cá»§a call"
          example: "call-uuid-123"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EndCallRequest' }
            examples:
              normal_hangup:
                summary: "Normal hangup"
                value:
                  reason: "hangup"
              network_error:
                summary: "Network error"
                value:
                  reason: "network error"
              device_error:
                summary: "Device error"
                value:
                  reason: "device error"
              timeout:
                summary: "Timeout"
                value:
                  reason: "timeout"
      responses:
        '200':
          description: "Call ended successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
              example:
                success: true
                message: "Call ended"
                data:
                  id: "call-uuid-123"
                  channelId: "channel_1734160800000_1_10"
                  status: "ENDED"
                  callType: "VIDEO"
                  callerId: 1
                  callerName: "Nguyen Linh La"
                  callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  calleeId: 10
                  calleeName: "Nguyen Van A"
                  calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  createdAt: "2025-12-14T10:00:00.000Z"
                  durationSeconds: 180
        '400':
          description: "Bad Request - Call already ended or invalid reason."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                already_ended:
                  summary: "Call already ended"
                  value:
                    success: false
                    error:
                      code: "CALL_ALREADY_ENDED"
                      message: "Call already ended"
                    requestId: "req-end001"
                invalid_reason:
                  summary: "Invalid reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Validation failed"
                      details:
                        - field: "reason"
                          code: "PATTERN"
                          message: "Reason must be one of: hangup, network error, device error, timeout"
                    requestId: "req-end002"
        '401':
          description: "Unauthorized - Not a participant or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_participant:
                  summary: "Not a participant"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "You are not a participant of this call"
                    requestId: "req-end003"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-end004"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-end005"

  # --- Contacts Paths ---
  /v1/contacts:
    get:
      summary: "Get all contacts"
      description: "Láº¥y danh sÃ¡ch táº¥t cáº£ contacts cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
              example:
                success: true
                message: "Contacts retrieved successfully"
                data:
                  - id: 5
                    contactUserId: 10
                    username: "user10"
                    fullName: "Nguyen Van A"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    nickname: "Best Friend"
                    favorite: true
                    online: true
                    lastSeen: null
                    createdAt: "2025-12-10T10:20:30.456Z"
                  - id: 8
                    contactUserId: 15
                    username: "user15"
                    fullName: "Le Thi C"
                    avatarUrl: null
                    nickname: null
                    favorite: false
                    online: false
                    lastSeen: "2025-12-14T06:30:00.000Z"
                    createdAt: "2025-12-11T14:15:20.123Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-contacts001"
    post:
      summary: "Add a new contact"
      description: "ThÃªm má»™t contact má»›i vÃ o danh báº¡."
      tags: [Contacts]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddContactRequest' }
            example:
              contactUserId: 25
              nickname: "My Colleague"
      responses:
        '201':
          description: "Contact added successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
              example:
                success: true
                message: "Contact added successfully"
                data:
                  id: 12
                  contactUserId: 25
                  username: "user25"
                  fullName: "Pham Van D"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                  nickname: "My Colleague"
                  favorite: false
                  online: true
                  lastSeen: null
                  createdAt: "2025-12-14T09:00:00.000Z"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                add_yourself:
                  summary: "Cannot add yourself"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot add yourself as contact"
                    requestId: "req-addcontact001"
                already_exists:
                  summary: "Contact already exists"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Contact already exists"
                    requestId: "req-addcontact002"
                missing_user_id:
                  summary: "Missing contactUserId"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Contact user ID is required"
                    requestId: "req-addcontact003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-addcontact004"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-addcontact005"

  /v1/contacts/favorites:
    get:
      summary: "Get favorite contacts"
      description: "Láº¥y danh sÃ¡ch contacts yÃªu thÃ­ch (Ä‘Ã£ Ä‘Ã¡nh dáº¥u favorite)."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Favorite contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
              example:
                success: true
                message: "Favorite contacts retrieved successfully"
                data:
                  - id: 5
                    contactUserId: 10
                    username: "user10"
                    fullName: "Nguyen Van A"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    nickname: "Best Friend"
                    favorite: true
                    online: true
                    lastSeen: null
                    createdAt: "2025-12-10T10:20:30.456Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-favcontacts001"

  /v1/contacts/{contactId}:
    put:
      summary: "Update a contact"
      description: "Cáº­p nháº­t thÃ´ng tin contact (nickname, favorite status)."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a contact cáº§n update"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateContactRequest' }
            examples:
              update_nickname:
                summary: "Update nickname"
                value:
                  nickname: "New Nickname"
              mark_favorite:
                summary: "Mark as favorite"
                value:
                  isFavorite: true
              update_both:
                summary: "Update both"
                value:
                  nickname: "VIP Friend"
                  isFavorite: true
      responses:
        '200':
          description: "Contact updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
              example:
                success: true
                message: "Contact updated successfully"
                data:
                  id: 5
                  contactUserId: 10
                  username: "user10"
                  fullName: "Nguyen Van A"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  nickname: "VIP Friend"
                  favorite: true
                  online: true
                  lastSeen: null
                  createdAt: "2025-12-10T10:20:30.456Z"
        '400':
          description: "Bad Request - No access to this contact."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this contact"
                requestId: "req-updatecontact001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-updatecontact002"
        '404':
          description: "Contact not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Contact not found"
                requestId: "req-updatecontact003"
    delete:
      summary: "Delete a contact"
      description: "XÃ³a má»™t contact khá»i danh báº¡."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a contact cáº§n xÃ³a"
      responses:
        '200':
          description: "Contact deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Contact deleted successfully"
                data: null
        '400':
          description: "Bad Request - No access to this contact."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this contact"
                requestId: "req-deletecontact001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-deletecontact002"
        '404':
          description: "Contact not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Contact not found"
                requestId: "req-deletecontact003"

  # --- Friend Requests Paths ---
  /v1/friend-requests:
    post:
      summary: "Send friend request"
      description: |
        Gá»­i lá»i má»i káº¿t báº¡n Ä‘áº¿n má»™t ngÆ°á»i dÃ¹ng.
        
        **Status Flow:**
        1. PENDING - Request Ä‘Æ°á»£c gá»­i, chá» accept/reject
        2. ACCEPTED - Request Ä‘Æ°á»£c cháº¥p nháº­n, táº¡o bidirectional contact
        3. REJECTED - Request bá»‹ tá»« chá»‘i
        
        **Note:** KhÃ´ng thá»ƒ gá»­i request náº¿u:
        - ÄÃ£ cÃ³ contact relationship (PENDING/ACCEPTED/BLOCKED)
        - Receiver lÃ  chÃ­nh mÃ¬nh
      tags: [Social]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SendFriendRequestRequest' }
            example:
              receiverUserId: 30
              nickname: "Potential Friend"
      responses:
        '201':
          description: "Friend request sent successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/FriendRequestResponse' }
              example:
                success: true
                message: "Friend request sent successfully"
                data:
                  id: 25
                  userId: 30
                  username: "user30"
                  fullName: "Hoang Van E"
                  avatarUrl: null
                  status: "PENDING"
                  nickname: "Potential Friend"
                  online: false
                  requestedAt: "2025-12-14T09:30:00.000Z"
                  acceptedAt: null
                  rejectedAt: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                send_to_yourself:
                  summary: "Cannot send to yourself"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot send friend request to yourself"
                    requestId: "req-friendreq001"
                already_sent:
                  summary: "Already sent"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request already sent"
                    requestId: "req-friendreq002"
                already_friends:
                  summary: "Already friends"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Already friends"
                    requestId: "req-friendreq003"
                user_blocked:
                  summary: "User is blocked"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot send friend request to blocked user"
                    requestId: "req-friendreq004"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreq005"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Receiver not found"
                requestId: "req-friendreq006"

  /v1/friend-requests/received:
    get:
      summary: "Get pending friend requests received"
      description: |
        Láº¥y danh sÃ¡ch lá»i má»i káº¿t báº¡n mÃ  user hiá»‡n táº¡i Ä‘Ã£ nháº­n (chÆ°a accept/reject).
        
        **Use case:** Hiá»ƒn thá»‹ notification "X wants to be your friend"
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Pending requests retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FriendRequestResponse'
              example:
                success: true
                message: "Pending requests retrieved successfully"
                data:
                  - id: 20
                    userId: 25
                    username: "user25"
                    fullName: "Pham Van D"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                    status: "PENDING"
                    nickname: null
                    online: true
                    requestedAt: "2025-12-14T08:00:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
                  - id: 22
                    userId: 28
                    username: "user28"
                    fullName: "Nguyen Thi F"
                    avatarUrl: null
                    status: "PENDING"
                    nickname: null
                    online: false
                    requestedAt: "2025-12-14T07:30:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreqrecv001"

  /v1/friend-requests/sent:
    get:
      summary: "Get pending friend requests sent"
      description: |
        Láº¥y danh sÃ¡ch lá»i má»i káº¿t báº¡n mÃ  user hiá»‡n táº¡i Ä‘Ã£ gá»­i (chÆ°a Ä‘Æ°á»£c accept/reject).
        
        **Use case:** Hiá»ƒn thá»‹ danh sÃ¡ch "Pending requests" Ä‘á»ƒ cÃ³ thá»ƒ cancel
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Sent requests retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FriendRequestResponse'
              example:
                success: true
                message: "Sent requests retrieved successfully"
                data:
                  - id: 18
                    userId: 22
                    username: "user22"
                    fullName: "Tran Van G"
                    avatarUrl: null
                    status: "PENDING"
                    nickname: "Work Colleague"
                    online: false
                    requestedAt: "2025-12-14T06:00:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreqsent001"

  /v1/friend-requests/{requestId}/accept:
    post:
      summary: "Accept friend request"
      description: |
        Cháº¥p nháº­n lá»i má»i káº¿t báº¡n.
        
        **Action:**
        - Set request status = ACCEPTED
        - Táº¡o reverse contact (bidirectional friendship)
        - Both users become friends
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a friend request cáº§n accept"
      responses:
        '200':
          description: "Friend request accepted successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/FriendRequestResponse' }
              example:
                success: true
                message: "Friend request accepted successfully"
                data:
                  id: 20
                  userId: 25
                  username: "user25"
                  fullName: "Pham Van D"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                  status: "ACCEPTED"
                  nickname: null
                  online: true
                  requestedAt: "2025-12-14T08:00:00.000Z"
                  acceptedAt: "2025-12-14T09:45:00.000Z"
                  rejectedAt: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_receiver:
                  summary: "Not the receiver"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the receiver of this request"
                    requestId: "req-acceptreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-acceptreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-acceptreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-acceptreq004"

  /v1/friend-requests/{requestId}/reject:
    post:
      summary: "Reject friend request"
      description: |
        Tá»« chá»‘i lá»i má»i káº¿t báº¡n.
        
        **Action:**
        - Set request status = REJECTED
        - Keep the record for history (not deleted)
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a friend request cáº§n reject"
      responses:
        '204':
          description: "Friend request rejected successfully (no content)."
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_receiver:
                  summary: "Not the receiver"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the receiver of this request"
                    requestId: "req-rejectreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-rejectreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-rejectreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-rejectreq004"

  /v1/friend-requests/{requestId}:
    delete:
      summary: "Cancel friend request"
      description: |
        Há»§y lá»i má»i káº¿t báº¡n Ä‘Ã£ gá»­i (chá»‰ sender má»›i cÃ³ thá»ƒ cancel).
        
        **Action:**
        - Delete the request record completely
        - Only PENDING requests can be cancelled
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID cá»§a friend request cáº§n cancel"
      responses:
        '204':
          description: "Friend request cancelled successfully (no content)."
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_sender:
                  summary: "Not the sender"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the sender of this request"
                    requestId: "req-cancelreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-cancelreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-cancelreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-cancelreq004"

