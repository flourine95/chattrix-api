openapi: 3.0.1
info:
  title: Chattrix API
  description: |
    API to√†n di·ªán cho ·ª©ng d·ª•ng Chattrix, bao g·ªìm x√°c th·ª±c, qu·∫£n l√Ω ng∆∞·ªùi d√πng, v√† t√≠nh nƒÉng g·ªçi ƒëi·ªán th·ªùi gian th·ª±c.

    ---

    ### Chi ti·∫øt c√°c s·ª± ki·ªán WebSocket
    T·∫•t c·∫£ c√°c tin nh·∫Øn t·ª´ server ƒë·ªÅu ƒë∆∞·ª£c b·ªçc trong m·ªôt ƒë·ªëi t∆∞·ª£ng `WebSocketMessage` chung.
    
    **Message Events:**
    *   **`chat.message`**: Tin nh·∫Øn tr√≤ chuy·ªán m·ªõi. (Payload: `OutgoingMessageDto`)
    *   **`message.updated`**: M·ªôt tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t. (Payload: `MessageUpdateDto`)
    *   **`message.deleted`**: M·ªôt tin nh·∫Øn ƒë√£ b·ªã x√≥a. (Payload: `MessageDeleteDto`)
    *   **`message.reaction`**: Reaction ƒë√£ ƒë∆∞·ª£c th√™m/x√≥a kh·ªèi tin nh·∫Øn. (Payload: `ReactionEventDto`)
    
    **Conversation Events:**
    *   **`conversation.update`**: Th√¥ng tin cu·ªôc tr√≤ chuy·ªán ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t (v√≠ d·ª•: tin nh·∫Øn cu·ªëi c√πng). (Payload: `ConversationUpdateDto`)
    *   **`typing.indicator`**: User ƒëang typing trong conversation. (Payload: `TypingIndicatorResponseDto`)
    
    **User Events:**
    *   **`user.status`**: Tr·∫°ng th√°i tr·ª±c tuy·∫øn c·ªßa ng∆∞·ªùi d√πng ƒë√£ thay ƒë·ªïi. (Payload: `UserStatusDto`)
    
    **Friend Request Events:**
    *   **`friend.request.received`**: Nh·∫≠n ƒë∆∞·ª£c friend request m·ªõi. (Payload: `FriendRequestResponse`)
    *   **`friend.request.accepted`**: Friend request ƒë∆∞·ª£c ch·∫•p nh·∫≠n. (Payload: `FriendRequestResponse`)
    *   **`friend.request.rejected`**: Friend request b·ªã t·ª´ ch·ªëi. (Payload: `FriendRequestRejectDto`)
    *   **`friend.request.cancelled`**: Friend request b·ªã h·ªßy b·ªüi ng∆∞·ªùi g·ª≠i. (Payload: `FriendRequestCancelDto`)
    
    **Note Events:**
    *   **`note.created`**: Note m·ªõi ƒë∆∞·ª£c t·∫°o t·ª´ contact. (Payload: `UserNoteDto`)
    *   **`note.updated`**: Note c·ªßa contact ƒë∆∞·ª£c c·∫≠p nh·∫≠t. (Payload: `UserNoteDto`)
    *   **`note.deleted`**: Note c·ªßa contact b·ªã x√≥a. (Payload: `NoteDeleteDto`)
    
    **Call Events:**
    *   **`call.incoming`**: Th√¥ng b√°o c√≥ cu·ªôc g·ªçi ƒë·∫øn. (Payload: `CallInvitationDto`)
    *   **`call.accepted`**: Cu·ªôc g·ªçi ƒë√£ ƒë∆∞·ª£c ch·∫•p nh·∫≠n. (Payload: `CallAcceptDto`)
    *   **`call.rejected`**: Cu·ªôc g·ªçi ƒë√£ b·ªã t·ª´ ch·ªëi. (Payload: `CallRejectDto`)
    *   **`call.ended`**: Cu·ªôc g·ªçi ƒë√£ k·∫øt th√∫c. (Payload: `CallEndDto`)
    *   **`call.timeout`**: Cu·ªôc g·ªçi h·∫øt th·ªùi gian ch·ªù. (Payload: `CallTimeoutDto`)
  version: "1.0.0"
servers:
  - url: /api
    description: Server API ch√≠nh

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    # --- Auth & User Schemas ---
    LoginRequest:
      type: object
      required: [usernameOrEmail, password]
      properties:
        usernameOrEmail: { type: string, description: "T√™n ƒëƒÉng nh·∫≠p ho·∫∑c email c·ªßa ng∆∞·ªùi d√πng." }
        password: { type: string, format: password, description: "M·∫≠t kh·∫©u." }

    RegisterRequest:
      type: object
      required: [username, email, password, fullName]
      properties:
        username: { type: string, description: "T√™n ƒëƒÉng nh·∫≠p m·ªõi." }
        email: { type: string, format: email, description: "Email c·ªßa ng∆∞·ªùi d√πng." }
        password: { type: string, format: password, description: "M·∫≠t kh·∫©u." }
        fullName: { type: string, description: "H·ªç v√† t√™n ƒë·∫ßy ƒë·ªß." }

    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken: { type: string, description: "Refresh token nh·∫≠n ƒë∆∞·ª£c khi ƒëƒÉng nh·∫≠p." }
    
    AuthResponse:
      type: object
      properties:
        accessToken: { type: string, description: "Token truy c·∫≠p ch√≠nh." }
        refreshToken: { type: string, description: "Token d√πng ƒë·ªÉ l√†m m·ªõi access token." }
        tokenType: { type: string, example: "Bearer" }
        expiresIn: { type: integer, format: int64, description: "Th·ªùi gian h·∫øt h·∫°n c·ªßa access token (t√≠nh b·∫±ng gi√¢y)." }

    UserResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        username: { type: string }
        email: { type: string, format: email }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        isOnline: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }

    # --- Message Schemas ---
    MessageResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        senderId: { type: integer, format: int64 }
        senderUsername: { type: string, nullable: true }
        senderFullName: { type: string, nullable: true }
        content: { type: string, nullable: true }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION], description: "Message type" }
        # Rich media fields
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true, description: "Duration in seconds for audio/video" }
        # Location fields
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }
        # Reply context
        replyToMessageId: { type: integer, format: int64, nullable: true }
        replyToMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
        # Reactions: {"üëç": [1, 2, 3], "‚ù§Ô∏è": [4, 5]}
        reactions:
          type: object
          description: "Map of emoji to array of user IDs"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        # Mentions
        mentions:
          type: array
          nullable: true
          items:
            type: integer
            format: int64
        mentionedUsers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }
        # Timestamps
        sentAt: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        # Edit/Delete/Forward
        edited: { type: boolean, default: false }
        editedAt: { type: string, format: date-time, nullable: true }
        deleted: { type: boolean, default: false }
        deletedAt: { type: string, format: date-time, nullable: true }
        forwarded: { type: boolean, default: false }
        originalMessageId: { type: integer, format: int64, nullable: true }
        forwardCount: { type: integer, format: int32, default: 0 }
        # Read receipts
        readCount: { type: integer, format: int64, default: 0 }
        readBy:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }
              avatarUrl: { type: string }
              readAt: { type: string, format: date-time }
      example:
        id: 5
        conversationId: 1
        senderId: 2
        senderUsername: "user2"
        senderFullName: "Tran Van Binh"
        content: "H√¨ h√¨ ƒë√∫ng th·∫≠t, c≈©ng ƒë√£ nhi·ªÅu nƒÉm tr√¥i qua"
        type: "TEXT"
        reactions: {}
        sentAt: "2025-12-14T06:18:25.432835Z"
        createdAt: "2025-12-14T06:18:25.432836Z"
        updatedAt: "2025-12-14T06:18:25.432837Z"
        edited: false
        deleted: false
        forwarded: false
        forwardCount: 0
        readCount: 1
        readBy:
          - userId: 1
            username: "user1"
            fullName: "Nguyen Linh La"
            avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
            readAt: "2025-12-14T06:50:24.557Z"

    ChatMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION], default: TEXT }
        replyToMessageId: { type: integer, format: int64, nullable: true }
        mentions:
          type: array
          items:
            type: integer
            format: int64
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }

    UpdateMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string, description: "N·ªôi dung m·ªõi c·ªßa tin nh·∫Øn." }

    # --- Call Schemas ---
    CallResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        channelId: { type: string }
        status: { type: string, enum: [RINGING, CONNECTING, CONNECTED, REJECTED, ENDED, INITIATING] }
        callType: { type: string, enum: [AUDIO, VIDEO] }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri, nullable: true }
        calleeId: { type: integer, format: int64 }
        calleeName: { type: string }
        calleeAvatar: { type: string, format: uri, nullable: true }
        createdAt: { type: string, format: date-time }
        durationSeconds: { type: integer, nullable: true }

    CallConnectionResponse:
      type: object
      properties:
        callInfo: { $ref: '#/components/schemas/CallResponse' }
        token: { type: string, description: "Token (v√≠ d·ª•: Agora Token) ƒë·ªÉ k·∫øt n·ªëi v√†o phi√™n g·ªçi." }

    # --- Generic API Response Wrappers ---
    ApiResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { nullable: true }

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              example: "RESOURCE_NOT_FOUND"
            message:
              type: string
              example: "The requested resource was not found"
        requestId:
          type: string
          example: "req-12345-abcde"

    ApiResponse_AuthResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/AuthResponse' }

    ApiResponse_UserResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserResponse' }
    
    ApiResponse_UserListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'

    ApiResponse_MessageResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageResponse' }

    ApiResponse_MessageListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/MessageResponse'

    ApiResponse_CallConnectionResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallConnectionResponse' }

    ApiResponse_CallResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallResponse' }

    # --- Request Schemas ---
    InitiateCallRequest:
      type: object
      required: [calleeId, callType]
      properties:
        calleeId: { type: integer, format: int64 }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    RejectCallRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, enum: [busy, declined, unavailable] }

    EndCallRequest:
      type: object
      properties:
        reason: { type: string, enum: [hangup, "network error", "device error", timeout], default: "hangup" }

    # --- WebSocket DTOs ---
    OutgoingMessageDto:
      type: object
      description: "WebSocket payload for new chat message (event: chat.message)"
      properties:
        id: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        sender:
          type: object
          properties:
            id: { type: integer, format: int64 }
            username: { type: string }
            fullName: { type: string }
            avatarUrl: { type: string, format: uri, nullable: true }
        content: { type: string }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION] }
        createdAt: { type: string, format: date-time }
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }
        replyToMessageId: { type: integer, format: int64, nullable: true }
        replyToMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
        reactions:
          type: object
          description: "Map of emoji to array of user IDs"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        mentions:
          type: array
          nullable: true
          items:
            type: integer
            format: int64
        mentionedUsers:
          type: array
          nullable: true
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }

    MessageUpdateDto:
      type: object
      description: "WebSocket payload for message update (event: message.updated)"
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        content: { type: string }
        edited: { type: boolean }
        updatedAt: { type: string, format: date-time }

    MessageDeleteDto:
      type: object
      description: "WebSocket payload for message deletion (event: message.deleted)"
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }

    ConversationUpdateDto:
      type: object
      description: "WebSocket payload for conversation update (event: conversation.update)"
      properties:
        conversationId: { type: integer, format: int64 }
        updatedAt: { type: string, format: date-time }
        lastMessage:
          type: object
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
            sentAt: { type: string, format: date-time }
            type: { type: string }

    ReactionEventDto:
      type: object
      description: "WebSocket payload for reaction events (event: message.reaction)"
      properties:
        messageId: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        userName: { type: string }
        emoji: { type: string }
        action: { type: string, enum: [add, remove] }
        reactions:
          type: object
          description: "Updated reactions map"
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        timestamp: { type: string, format: date-time }

    TypingIndicatorDto:
      type: object
      description: "Client-to-server payload for typing indicator (send to server)"
      properties:
        conversationId: { type: integer, format: int64 }
        typing: { type: boolean, description: "true = start typing, false = stop typing" }

    TypingIndicatorResponseDto:
      type: object
      description: "WebSocket payload for typing indicator (event: typing.indicator)"
      properties:
        conversationId: { type: integer, format: int64 }
        typingUsers:
          type: array
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              fullName: { type: string }

    UserStatusDto:
      type: object
      description: "WebSocket payload for user status change (event: user.status)"
      properties:
        userId: { type: string }
        username: { type: string }
        fullName: { type: string }
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }

    FriendRequestRejectDto:
      type: object
      description: "WebSocket payload for friend request rejected (event: friend.request.rejected)"
      properties:
        requestId: { type: integer, format: int64 }
        rejectedBy: { type: integer, format: int64 }

    FriendRequestCancelDto:
      type: object
      description: "WebSocket payload for friend request cancelled (event: friend.request.cancelled)"
      properties:
        requestId: { type: integer, format: int64 }
        cancelledBy: { type: integer, format: int64 }

    CallInvitationDto:
      type: object
      description: "WebSocket payload for incoming call (event: call.incoming)"
      properties:
        callId: { type: string }
        channelId: { type: string }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri, nullable: true }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    CallAcceptDto:
      type: object
      description: "WebSocket payload for call accepted (event: call.accepted)"
      properties:
        callId: { type: string }
        acceptedBy: { type: integer, format: int64 }

    CallRejectDto:
      type: object
      description: "WebSocket payload for call rejected (event: call.rejected)"
      properties:
        callId: { type: string }
        rejectedBy: { type: integer, format: int64 }
        reason: { type: string, enum: [busy, declined, unavailable] }

    CallEndDto:
      type: object
      description: "WebSocket payload for call ended (event: call.ended)"
      properties:
        callId: { type: string }
        endedBy: { type: integer, format: int64 }
        durationSeconds: { type: integer }

    CallTimeoutDto:
      type: object
      description: "WebSocket payload for call timeout (event: call.timeout)"
      properties:
        callId: { type: string }
        reason: { type: string, example: "no_answer" }


    # --- Contacts & Social Schemas ---
    ContactResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        contactUserId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        nickname: { type: string, nullable: true }
        favorite: { type: boolean }
        online: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }
      example:
        id: 5
        contactUserId: 10
        username: "user10"
        fullName: "Nguyen Van A"
        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
        nickname: "Best Friend"
        favorite: true
        online: true
        lastSeen: "2025-12-14T08:30:15.123Z"
        createdAt: "2025-12-10T10:20:30.456Z"

    AddContactRequest:
      type: object
      required: [contactUserId]
      properties:
        contactUserId:
          type: integer
          format: int64
          description: "User ID c·ªßa ng∆∞·ªùi c·∫ßn add v√†o contacts"
        nickname:
          type: string
          nullable: true
          description: "Nickname cho contact (optional)"

    UpdateContactRequest:
      type: object
      properties:
        nickname:
          type: string
          nullable: true
          description: "Update nickname"
        isFavorite:
          type: boolean
          nullable: true
          description: "Mark as favorite ho·∫∑c unfavorite"

    FriendRequestResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64, description: "ID c·ªßa ng∆∞·ªùi g·ª≠i/nh·∫≠n (t√πy context)" }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        status: { type: string, enum: [PENDING, ACCEPTED, REJECTED, BLOCKED] }
        nickname: { type: string, nullable: true }
        online: { type: boolean }
        requestedAt: { type: string, format: date-time }
        acceptedAt: { type: string, format: date-time, nullable: true }
        rejectedAt: { type: string, format: date-time, nullable: true }
      example:
        id: 15
        userId: 20
        username: "user20"
        fullName: "Tran Thi B"
        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/20.png"
        status: "PENDING"
        nickname: null
        online: false
        requestedAt: "2025-12-14T07:00:00.000Z"
        acceptedAt: null
        rejectedAt: null

    SendFriendRequestRequest:
      type: object
      required: [receiverUserId]
      properties:
        receiverUserId:
          type: integer
          format: int64
          description: "User ID c·ªßa ng∆∞·ªùi nh·∫≠n friend request"
        nickname:
          type: string
          nullable: true
          description: "Nickname cho friend (optional)"

    # --- Read Receipts Schemas ---
    ReadReceiptResponse:
      type: object
      properties:
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        readAt: { type: string, format: date-time }

    # --- Reaction Schemas ---
    AddReactionRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10 }

    MessageReactionsResponse:
      type: object
      properties:
        messageId: { type: integer, format: int64 }
        reactions:
          type: object
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
          description: "Map of emoji to array of user IDs. Example: {'üëç': [1, 2, 3], '‚ù§Ô∏è': [4, 5]}"

    # --- Conversation Members Schemas ---
    ConversationParticipantResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        user: { $ref: '#/components/schemas/UserResponse' }
        role: { type: string, enum: [ADMIN, MEMBER] }
        joinedAt: { type: string, format: date-time }
        unreadCount: { type: integer }

    AddMembersRequest:
      type: object
      required: [userIds]
      properties:
        userIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateMemberRoleRequest:
      type: object
      required: [role]
      properties:
        role: { type: string, enum: [ADMIN, MEMBER] }

    # --- Conversation Schemas ---
    ConversationResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        name: { type: string, nullable: true, description: "T√™n conversation (ch·ªâ c√≥ trong GROUP)" }
        type: { type: string, enum: [DIRECT, GROUP] }
        avatarUrl: { type: string, format: uri, nullable: true, description: "Avatar URL (ch·ªâ c√≥ trong GROUP)" }
        participants:
          type: array
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              role: { type: string, enum: [ADMIN, MEMBER] }
          description: "Danh s√°ch participants v·ªõi userId, username v√† role"
        lastMessage:
          type: object
          nullable: true
          properties:
            id: { type: integer, format: int64 }
            content: { type: string }
            senderId: { type: integer, format: int64 }
            senderUsername: { type: string }
            sentAt: { type: string, format: date-time }
            type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION] }
            readCount: { type: integer, format: int64 }
            readBy:
              type: array
              items:
                type: object
                properties:
                  userId: { type: integer, format: int64 }
                  username: { type: string }
                  fullName: { type: string }
                  avatarUrl: { type: string }
                  readAt: { type: string, format: date-time }
          description: "Last message in the conversation, or null if empty."
        unreadCount: { type: integer, description: "S·ªë tin nh·∫Øn ch∆∞a ƒë·ªçc" }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      example:
        id: 1
        type: "DIRECT"
        createdAt: "2025-12-14T05:57:39.801682Z"
        updatedAt: "2025-12-14T06:29:24.717139Z"
        participants:
          - userId: 1
            username: "user1"
            role: "ADMIN"
          - userId: 2
            username: "user2"
            role: "MEMBER"
        lastMessage:
          id: 8
          content: "Tao ph·∫£i ƒë·ª° cho em tao"
          senderId: 2
          senderUsername: "user2"
          sentAt: "2025-12-14T06:29:24.691046Z"
          type: "TEXT"
          readCount: 0
          readBy: []
        unreadCount: 4

    CreateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        type: { type: string, enum: [DIRECT, GROUP], default: DIRECT }
        participantIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }

    # --- User Profile Schemas ---
    UpdateProfileRequest:
      type: object
      properties:
        fullName: { type: string, nullable: true }
        bio: { type: string, maxLength: 500, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }
        phone: { type: string, nullable: true }
        dateOfBirth: { type: string, format: date, nullable: true }
        gender: { type: string, enum: [MALE, FEMALE, OTHER], nullable: true }
        location: { type: string, nullable: true }

    # --- API Response Wrappers ---
    ApiResponse_ContactResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ContactResponse' }

    ApiResponse_ContactListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ContactResponse'

    ApiResponse_ReadReceiptListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ReadReceiptResponse'

    ApiResponse_MessageReactionsResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageReactionsResponse' }

    ApiResponse_ConversationResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ConversationResponse' }

    ApiResponse_ConversationListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConversationResponse'

    ApiResponse_ParticipantListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConversationParticipantResponse'

    # --- Messenger Notes Schemas ---
    UserNoteRequest:
      type: object
      required: [noteText]
      properties:
        noteText:
          type: string
          maxLength: 60
          description: "N·ªôi dung note (t·ªëi ƒëa 60 k√Ω t·ª±)."
        musicUrl:
          type: string
          format: uri
          nullable: true
          description: "URL nh·∫°c ƒë√≠nh k√®m (optional)."
        musicTitle:
          type: string
          maxLength: 100
          nullable: true
          description: "T√™n b√†i nh·∫°c (optional)."
        emoji:
          type: string
          maxLength: 10
          nullable: true
          description: "Emoji ƒë·∫°i di·ªán (optional)."

    UserNoteResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        noteText: { type: string, maxLength: 60 }
        musicUrl: { type: string, format: uri, nullable: true }
        musicTitle: { type: string, nullable: true }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time, description: "Note t·ª± ƒë·ªông x√≥a sau 24h." }
        replyCount: { type: integer, format: int64, description: "T·ªïng s·ªë messages (replies + reactions)." }

    NoteReplyRequest:
      type: object
      required: [replyText]
      properties:
        replyText: { type: string, description: "N·ªôi dung reply." }

    NoteReactRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10, description: "Emoji reaction." }

    UserNoteDto:
      type: object
      description: "WebSocket payload cho note events."
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        noteText: { type: string }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time }

    NoteDeleteDto:
      type: object
      properties:
        userId: { type: integer, format: int64 }

    ApiResponse_UserNoteResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserNoteResponse' }

    ApiResponse_UserNoteListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserNoteResponse'

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: "C√°c API li√™n quan ƒë·∫øn x√°c th·ª±c, ƒëƒÉng nh·∫≠p, ƒëƒÉng k√Ω v√† qu·∫£n l√Ω phi√™n l√†m vi·ªác."
  - name: Users
    description: "C√°c API li√™n quan ƒë·∫øn qu·∫£n l√Ω ng∆∞·ªùi d√πng."
  - name: Conversations
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω cu·ªôc tr√≤ chuy·ªán."
  - name: Messages
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω tin nh·∫Øn trong cu·ªôc tr√≤ chuy·ªán."
  - name: Notes
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω Messenger Notes (status 24h tr√™n avatar)."
  - name: Contacts
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω danh b·∫° v√† b·∫°n b√®."
  - name: Social
    description: "C√°c API cho t√≠nh nƒÉng x√£ h·ªôi (friend requests, etc)."
  - name: Call
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω t√≠nh nƒÉng g·ªçi ƒëi·ªán."

paths:
  # --- Auth Paths ---
  /v1/auth/register:
    post:
      summary: "User Registration"
      description: "ƒêƒÉng k√Ω m·ªôt t√†i kho·∫£n ng∆∞·ªùi d√πng m·ªõi."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RegisterRequest' }
      responses:
        '201':
          description: "Registration successful."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
              example:
                success: true
                message: "Registration successful. Please check your email to verify your account."
                data:
                  user:
                    id: 1
                    username: "newuser"
                    email: "newuser@example.com"
                    fullName: "New User"
                  accessToken: "eyJhbGciOiJIUzI1NiJ9..."
                  refreshToken: "refresh_token_here"
        '400':
          description: "Bad Request - Validation failed or user already exists."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                username_exists:
                  summary: "Username already taken"
                  value:
                    success: false
                    error:
                      code: "CONFLICT"
                      message: "Username already exists"
                    requestId: "req-reg001"
                email_exists:
                  summary: "Email already registered"
                  value:
                    success: false
                    error:
                      code: "CONFLICT"
                      message: "Email already exists"
                    requestId: "req-reg002"
                invalid_email:
                  summary: "Invalid email format"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Invalid email format"
                    requestId: "req-reg003"
                weak_password:
                  summary: "Password too weak"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Password must be at least 8 characters"
                    requestId: "req-reg004"

  /v1/auth/login:
    post:
      summary: "User Login"
      description: "X√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng username/email v√† password ƒë·ªÉ nh·∫≠n v·ªÅ access token v√† refresh token."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: "Login successful."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
              example:
                success: true
                message: "Login successful"
                data:
                  user:
                    id: 1
                    username: "user1"
                    email: "user1@example.com"
                    fullName: "Nguyen Linh La"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  accessToken: "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwidXNlcm5hbWUiOiJ1c2VyMSIsImp0aSI6ImZmYjM4NjU5LTMwMWUtNGQzNy1hNWQ1LTljNGIzNTUzNGYzMiIsImlhdCI6MTc2NTY5NDkxOSwiZXhwIjoxNzY1OTEwOTE5fQ.FjPFJXewRaHQg8ulpVXxbHAUoo24UH7hRdPA7mWzeO0"
                  refreshToken: "refresh_token_here"
        '400':
          description: "Bad Request - Invalid credentials."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_credentials:
                  summary: "Wrong username or password"
                  value:
                    success: false
                    error:
                      code: "INVALID_CREDENTIALS"
                      message: "Invalid username or password"
                    requestId: "req-login001"
                missing_fields:
                  summary: "Missing required fields"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Username and password are required"
                    requestId: "req-login002"
        '401':
          description: "Unauthorized - Account not verified or locked."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_verified:
                  summary: "Email not verified"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Please verify your email address before logging in"
                    requestId: "req-login003"
                account_locked:
                  summary: "Account locked"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Your account has been locked. Please contact support."
                    requestId: "req-login004"

  /v1/auth/refresh:
    post:
      summary: "Refresh Access Token"
      description: "S·ª≠ d·ª•ng refresh token ƒë·ªÉ l·∫•y m·ªôt access token m·ªõi."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshTokenRequest' }
      responses:
        '200':
          description: "Token refreshed successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
        '401':
          description: "Unauthorized (e.g., invalid or expired refresh token)."

  /v1/auth/me:
    get:
      summary: "Get Current User Info"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa ng∆∞·ªùi d√πng ƒëang ƒëƒÉng nh·∫≠p, d·ª±a tr√™n token x√°c th·ª±c."
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "User retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."

  # --- User Paths ---
  /v1/users:
    get:
      summary: "Get All Users"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng. Y√™u c·∫ßu x√°c th·ª±c."
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Users retrieved successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_UserListResponse'
        '401':
          description: "Unauthorized."

  /v1/users/search:
    get:
      summary: "Search users"
      description: "T√¨m ki·∫øm ng∆∞·ªùi d√πng theo username, email ho·∫∑c t√™n."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema: { type: string }
          description: "T·ª´ kh√≥a t√¨m ki·∫øm."
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
          description: "S·ªë l∆∞·ª£ng k·∫øt qu·∫£ t·ªëi ƒëa."
      responses:
        '200':
          description: "Users found successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserListResponse' }
        '401':
          description: "Unauthorized."

  /v1/profile/me:
    get:
      summary: "Get my profile"
      description: "L·∫•y th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
    put:
      summary: "Update my profile"
      description: "C·∫≠p nh·∫≠t th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateProfileRequest' }
      responses:
        '200':
          description: "Profile updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."

  /v1/profile/{userId}:
    get:
      summary: "Get user profile by ID"
      description: "L·∫•y th√¥ng tin profile c·ªßa m·ªôt ng∆∞·ªùi d√πng c·ª• th·ªÉ."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "User not found."

  /v1/profile/username/{username}:
    get:
      summary: "Get user profile by username"
      description: "L·∫•y th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng theo username."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "User not found."

  # --- Conversation Paths ---
  /v1/conversations:
    post:
      summary: "Create a new conversation"
      description: |
        T·∫°o m·ªôt cu·ªôc tr√≤ chuy·ªán m·ªõi (1-1 ho·∫∑c nh√≥m).
        
        **VALIDATION RULES:**
        - **DIRECT**: PH·∫¢I c√≥ ƒë√∫ng 1 participant kh√°c (ngo√†i current user)
          - ‚ùå WRONG: participantIds: [17, 18, 19] (3 ng∆∞·ªùi)
          - ‚úÖ CORRECT: participantIds: [17] (1 ng∆∞·ªùi)
          
        - **GROUP**: PH·∫¢I c√≥ √≠t nh·∫•t 1 participant kh√°c (ngo√†i current user)
          - ‚úÖ CORRECT: participantIds: [17, 18] (2+ ng∆∞·ªùi)
          - ‚úÖ CORRECT: participantIds: [17] (1 ng∆∞·ªùi, nh∆∞ng n√™n d√πng DIRECT thay v√¨ GROUP)
        
        **Note**: Current user t·ª± ƒë·ªông ƒë∆∞·ª£c th√™m v√†o conversation, kh√¥ng c·∫ßn ƒë∆∞a v√†o participantIds.
      tags: [Conversations]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateConversationRequest' }
            examples:
              direct:
                summary: "Direct conversation (1-1) - CORRECT"
                value:
                  type: "DIRECT"
                  participantIds: [17]
              direct_wrong:
                summary: "Direct conversation - WRONG (multiple participants)"
                value:
                  type: "DIRECT"
                  participantIds: [17, 18, 19]
              group:
                summary: "Group conversation - CORRECT"
                value:
                  name: "Team Chat"
                  type: "GROUP"
                  participantIds: [17, 18, 19]
      responses:
        '201':
          description: "Conversation created successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation created successfully"
                data:
                  id: 7
                  type: "DIRECT"
                  createdAt: "2025-12-14T06:50:02.634141682Z"
                  updatedAt: "2025-12-14T06:50:02.634143143Z"
                  participants:
                    - userId: 1
                      username: "user1"
                      role: "ADMIN"
                    - userId: 15
                      username: "sontrinh"
                      role: "MEMBER"
        '400':
          description: |
            Bad Request - Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                direct_multiple_participants:
                  summary: "DIRECT conversation with multiple participants"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "DIRECT conversation must have exactly 1 other participant. Found: 3"
                    requestId: "req-abc123"
                no_participants:
                  summary: "No participants provided"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "At least one participant is required"
                    requestId: "req-def456"
                participant_not_found:
                  summary: "Participant user not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Participant not found: 99999"
                    requestId: "req-ghi789"
                conversation_exists:
                  summary: "Conversation already exists (DIRECT)"
                  value:
                    success: false
                    error:
                      code: "CONFLICT"
                      message: "A conversation with this user already exists"
                    requestId: "req-jkl012"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-mno345"
    get:
      summary: "Get all conversations"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ cu·ªôc tr√≤ chuy·ªán c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i, s·∫Øp x·∫øp theo tin nh·∫Øn m·ªõi nh·∫•t. H·ªó tr·ª£ filter theo lo·∫°i conversation."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: filter
          in: query
          required: false
          description: |
            Filter conversations by type:
            - **all** (default): T·∫•t c·∫£ conversations
            - **unread**: Ch·ªâ conversations c√≥ tin nh·∫Øn ch∆∞a ƒë·ªçc
            - **group**: Ch·ªâ conversations nh√≥m (GROUP)
          schema:
            type: string
            enum: [all, unread, group]
            default: all
          example: all
      responses:
        '200':
          description: "Conversations retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationListResponse' }
              examples:
                all:
                  summary: "All conversations (filter=all)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 1
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:35:09.382687Z"
                        updatedAt: "2025-12-13T07:38:26.471576Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                        lastMessage:
                          id: 6
                          content: "ƒë√£ s·ª≠a nha"
                          senderId: 12
                          senderUsername: "hungly"
                          sentAt: "2025-12-13T07:38:26.438210Z"
                          type: "TEXT"
                      - id: 5
                        type: "GROUP"
                        createdAt: "2025-12-12T09:39:16.600310Z"
                        updatedAt: "2025-12-12T09:39:16.600313Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 3
                            username: "hoale"
                            role: "MEMBER"
                          - userId: 4
                            username: "tuanpham"
                            role: "MEMBER"
                          - userId: 2
                            username: "binhtran"
                            role: "MEMBER"
                          - userId: 5
                            username: "thuyvo"
                            role: "MEMBER"
                      - id: 4
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:38:52.749391Z"
                        updatedAt: "2025-12-12T09:38:52.749395Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                unread:
                  summary: "Only unread conversations (filter=unread)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 1
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:35:09.382687Z"
                        updatedAt: "2025-12-13T07:38:26.471576Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                        lastMessage:
                          id: 6
                          content: "ƒë√£ s·ª≠a nha"
                          senderId: 12
                          senderUsername: "hungly"
                          sentAt: "2025-12-13T07:38:26.438210Z"
                          type: "TEXT"
                group:
                  summary: "Only group conversations (filter=group)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 5
                        type: "GROUP"
                        createdAt: "2025-12-12T09:39:16.600310Z"
                        updatedAt: "2025-12-12T09:39:16.600313Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 3
                            username: "hoale"
                            role: "MEMBER"
                          - userId: 4
                            username: "tuanpham"
                            role: "MEMBER"
                          - userId: 2
                            username: "binhtran"
                            role: "MEMBER"
                          - userId: 5
                            username: "thuyvo"
                            role: "MEMBER"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"

  /v1/conversations/{conversationId}:
    get:
      summary: "Get a conversation"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt cu·ªôc tr√≤ chuy·ªán, bao g·ªìm participants v√† last message."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 1
      responses:
        '200':
          description: "Conversation retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation retrieved successfully"
                data:
                  id: 1
                  type: "DIRECT"
                  createdAt: "2025-12-12T09:35:09.382687Z"
                  updatedAt: "2025-12-13T07:38:26.471576Z"
                  participants:
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 17
                      username: "ducphan"
                      role: "MEMBER"
                  lastMessage:
                    id: 6
                    content: "ƒë√£ s·ª≠a nha"
                    senderId: 12
                    senderUsername: "hungly"
                    sentAt: "2025-12-13T07:38:26.438210Z"
                    type: "TEXT"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You do not have access to this conversation"
                requestId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "783376db-aad3-4ae8-9886-9074a79356d0"
    put:
      summary: "Update a conversation"
      description: |
        C·∫≠p nh·∫≠t th√¥ng tin cu·ªôc tr√≤ chuy·ªán (t√™n, avatar).
        - Ch·ªâ admin m·ªõi ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong group chat
        - Kh√¥ng th·ªÉ update direct conversation
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateConversationRequest' }
            example:
              name: "day la group"
              avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
      responses:
        '200':
          description: "Conversation updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation updated successfully"
                data:
                  id: 7
                  type: "GROUP"
                  name: "day la group"
                  avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
                  createdAt: "2025-12-13T09:14:14.522996Z"
                  updatedAt: "2025-12-13T09:14:14.522999Z"
                  participants:
                    - userId: 5
                      username: "thuyvo"
                      role: "MEMBER"
                    - userId: 4
                      username: "tuanpham"
                      role: "MEMBER"
                    - userId: 6
                      username: "thanhdang"
                      role: "MEMBER"
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 2
                      username: "binhtran"
                      role: "MEMBER"
                    - userId: 3
                      username: "hoale"
                      role: "MEMBER"
        '400':
          description: "Bad Request - Validation failed or no access."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "b1c2d3e4-f5a6-7890-bcde-f12345678901"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '403':
          description: "Forbidden - Only admin can update."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "FORBIDDEN" }
                      message: { type: string, example: "Only admin can update group conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "Only admin can update group conversation"
                requestId: "c2d3e4f5-a6b7-8901-cdef-234567890abc"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "d3e4f5a6-b7c8-9012-def0-34567890abcd"
    delete:
      summary: "Delete a conversation"
      description: |
        X√≥a m·ªôt cu·ªôc tr√≤ chuy·ªán (user r·ªùi kh·ªèi conversation).
        - User s·∫Ω b·ªã remove kh·ªèi participants list
        - C√≥ th·ªÉ √°p d·ª•ng cho c·∫£ DIRECT v√† GROUP conversation
        - Conversation v·∫´n t·ªìn t·∫°i cho c√°c participants kh√°c
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      responses:
        '200':
          description: "Conversation deleted successfully (user left the conversation)."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Conversation deleted successfully" }
              example:
                success: true
                message: "Conversation deleted successfully"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "e4f5a6b7-c8d9-0123-ef01-4567890abcde"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "f5a6b7c8-d9e0-1234-f012-567890abcdef"

  # --- Message Paths ---
  /v1/conversations/{conversationId}/messages:
    get:
      summary: "Get conversation messages"
      description: "L·∫•y danh s√°ch tin nh·∫Øn trong m·ªôt cu·ªôc tr√≤ chuy·ªán, c√≥ h·ªó tr·ª£ ph√¢n trang."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: "S·ªë trang (b·∫Øt ƒë·∫ßu t·ª´ 0)."
        - name: size
          in: query
          schema:
            type: integer
            default: 50
          description: "K√≠ch th∆∞·ªõc trang."
        - name: sort
          in: query
          schema:
            type: string
            default: "DESC"
            enum: [ASC, DESC]
          description: "Th·ª© t·ª± s·∫Øp x·∫øp theo th·ªùi gian."
      responses:
        '200':
          description: "Messages retrieved successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageListResponse'
              example:
                success: true
                message: "Messages retrieved successfully"
                data:
                  - id: 8
                    conversationId: 1
                    senderId: 2
                    senderUsername: "user2"
                    senderFullName: "Tran Van Binh"
                    content: "Tao ph·∫£i ƒë·ª° cho em tao"
                    type: "TEXT"
                    reactions: {}
                    sentAt: "2025-12-14T06:29:24.691046Z"
                    createdAt: "2025-12-14T06:29:24.691048Z"
                    updatedAt: "2025-12-14T06:29:24.691049Z"
                    edited: false
                    deleted: false
                    forwarded: false
                    forwardCount: 0
                    readCount: 0
                  - id: 5
                    conversationId: 1
                    senderId: 2
                    senderUsername: "user2"
                    senderFullName: "Tran Van Binh"
                    content: "H√¨ h√¨ ƒë√∫ng th·∫≠t, c≈©ng ƒë√£ nhi·ªÅu nƒÉm tr√¥i qua"
                    type: "TEXT"
                    reactions: {}
                    sentAt: "2025-12-14T06:18:25.432835Z"
                    createdAt: "2025-12-14T06:18:25.432836Z"
                    updatedAt: "2025-12-14T06:18:25.432837Z"
                    edited: false
                    deleted: false
                    forwarded: false
                    forwardCount: 0
                    readCount: 1
                    readBy:
                      - userId: 1
                        username: "user1"
                        fullName: "Nguyen Linh La"
                        avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                        readAt: "2025-12-14T06:50:24.557Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-msgs001"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-msgs002"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-msgs003"
    post:
      summary: "Send a message"
      description: "G·ª≠i m·ªôt tin nh·∫Øn m·ªõi v√†o cu·ªôc tr√≤ chuy·ªán."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatMessageRequest'
      responses:
        '201':
          description: "Message sent successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageResponse'
              example:
                success: true
                message: "Message sent successfully"
                data:
                  id: 25
                  conversationId: 1
                  senderId: 1
                  senderUsername: "user1"
                  senderFullName: "Nguyen Linh La"
                  content: "Hello, how are you?"
                  type: "TEXT"
                  reactions: {}
                  sentAt: "2025-12-14T06:53:17.372188410Z"
                  createdAt: "2025-12-14T06:53:17.372191027Z"
                  updatedAt: "2025-12-14T06:53:17.372191325Z"
                  edited: false
                  deleted: false
                  forwarded: false
                  forwardCount: 0
                  readCount: 0
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                empty_content:
                  summary: "Empty message content"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Content is required"
                    requestId: "req-msg001"
                invalid_reply:
                  summary: "Reply to non-existent message"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Reply message not found: 99999"
                    requestId: "req-msg002"
                invalid_mentions:
                  summary: "Mention non-existent user"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Mentioned user not found: 88888"
                    requestId: "req-msg003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-msg004"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-msg005"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-msg006"

  /v1/conversations/{conversationId}/messages/{messageId}:
    get:
      summary: "Get a specific message"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt tin nh·∫Øn c·ª• th·ªÉ."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
              example:
                success: true
                message: "Message retrieved successfully"
                data:
                  id: 5
                  conversationId: 1
                  senderId: 2
                  senderUsername: "user2"
                  senderFullName: "Tran Van Binh"
                  content: "H√¨ h√¨ ƒë√∫ng th·∫≠t, c≈©ng ƒë√£ nhi·ªÅu nƒÉm tr√¥i qua"
                  type: "TEXT"
                  reactions: {}
                  sentAt: "2025-12-14T06:18:25.432835Z"
                  createdAt: "2025-12-14T06:18:25.432836Z"
                  updatedAt: "2025-12-14T06:18:25.432837Z"
                  edited: false
                  deleted: false
                  forwarded: false
                  forwardCount: 0
                  readCount: 1
                  readBy:
                    - userId: 1
                      username: "user1"
                      fullName: "Nguyen Linh La"
                      avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                      readAt: "2025-12-14T06:50:24.557Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getmsg001"
        '403':
          description: "Forbidden - Not a member of this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You are not a member of this conversation"
                requestId: "req-getmsg002"
        '404':
          description: "Message or Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                message_not_found:
                  summary: "Message not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Message not found"
                    requestId: "req-getmsg003"
                conversation_not_found:
                  summary: "Conversation not found"
                  value:
                    success: false
                    error:
                      code: "RESOURCE_NOT_FOUND"
                      message: "Conversation not found"
                    requestId: "req-getmsg004"
    put:
      summary: "Update a message"
      description: "C·∫≠p nh·∫≠t n·ªôi dung c·ªßa m·ªôt tin nh·∫Øn ƒë√£ g·ª≠i. Ch·ªâ ng∆∞·ªùi g·ª≠i m·ªõi c√≥ th·ªÉ s·ª≠a tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateMessageRequest' }
      responses:
        '200':
          description: "Message updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
              example:
                success: true
                message: "Message edited successfully"
                data:
                  id: 3
                  conversationId: 1
                  senderId: 1
                  senderUsername: "user1"
                  senderFullName: "Nguyen Linh La"
                  content: "da thay doi"
                  type: "TEXT"
                  sentAt: "2025-12-14T06:10:21.019500Z"
                  edited: true
                  editedAt: "2025-12-14T06:51:40.617582834Z"
                  deleted: false
                  forwarded: false
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                empty_content:
                  summary: "Empty message content"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Content is required"
                    requestId: "req-editmsg001"
                message_deleted:
                  summary: "Cannot edit deleted message"
                  value:
                    success: false
                    error:
                      code: "BUSINESS_ERROR"
                      message: "Cannot edit a deleted message"
                    requestId: "req-editmsg002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-editmsg003"
        '403':
          description: "Forbidden - Not the message sender."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You can only edit your own messages"
                requestId: "req-editmsg004"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-editmsg005"
    delete:
      summary: "Delete a message"
      description: "X√≥a m·ªôt tin nh·∫Øn ƒë√£ g·ª≠i. Ch·ªâ ng∆∞·ªùi g·ª≠i m·ªõi c√≥ th·ªÉ x√≥a tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Message deleted successfully"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-delmsg001"
        '403':
          description: "Forbidden - Not the message sender."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "You can only delete your own messages"
                requestId: "req-delmsg002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-delmsg003"

  # --- Message Reactions ---
  /v1/messages/{messageId}/reactions:
    post:
      summary: "Add or toggle reaction"
      description: "Th√™m ho·∫∑c toggle reaction (emoji) v√†o tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddReactionRequest' }
      responses:
        '200':
          description: "Reaction toggled successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reaction toggled successfully"
                data:
                  messageId: 1
                  reactions:
                    "üòÄ":
                      - 1
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "Emoji is required"
                requestId: "req-react001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-react002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-react003"
    get:
      summary: "Get message reactions"
      description: "L·∫•y t·∫•t c·∫£ reactions c·ªßa m·ªôt tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Reactions retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reactions retrieved successfully"
                data:
                  messageId: 1
                  reactions:
                    "üòÄ":
                      - 1
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getreact001"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-getreact002"

  /v1/messages/{messageId}/reactions/{emoji}:
    delete:
      summary: "Remove reaction"
      description: "X√≥a reaction c·ªßa user hi·ªán t·∫°i kh·ªèi tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: emoji
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: "Reaction removed successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
              example:
                success: true
                message: "Reaction removed successfully"
                data:
                  messageId: 1
                  reactions: {}
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-delreact001"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-delreact002"

  # --- Read Receipts ---
  /v1/read-receipts/messages/{messageId}:
    post:
      summary: "Mark message as read"
      description: "ƒê√°nh d·∫•u m·ªôt tin nh·∫Øn c·ª• th·ªÉ l√† ƒë√£ ƒë·ªçc. T·ª± ƒë·ªông t·∫°o read receipt."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa tin nh·∫Øn c·∫ßn ƒë√°nh d·∫•u ƒë√£ ƒë·ªçc"
      responses:
        '204':
          description: "Message marked as read successfully (no content)."
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-read001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-read002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-read003"
    get:
      summary: "Get read receipts for message"
      description: "L·∫•y danh s√°ch ng∆∞·ªùi d√πng ƒë√£ ƒë·ªçc tin nh·∫Øn n√†y, bao g·ªìm th·ªùi gian ƒë·ªçc."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa tin nh·∫Øn"
      responses:
        '200':
          description: "Read receipts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ReadReceiptListResponse' }
              example:
                success: true
                message: "Read receipts retrieved successfully"
                data:
                  - userId: 1
                    username: "user1"
                    fullName: "Nguyen Linh La"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    readAt: "2025-12-14T06:50:24.557Z"
                  - userId: 3
                    username: "hoale"
                    fullName: "Le Thi Hoa"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/3.png"
                    readAt: "2025-12-14T07:15:30.123Z"
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-getread001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-getread002"
        '404':
          description: "Message not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Message not found"
                requestId: "req-getread003"

  /v1/read-receipts/conversations/{conversationId}:
    post:
      summary: "Mark conversation as read"
      description: |
        ƒê√°nh d·∫•u t·∫•t c·∫£ tin nh·∫Øn trong conversation l√† ƒë√£ ƒë·ªçc.
        
        **Features:**
        - T·∫°o read receipts cho t·∫•t c·∫£ tin nh·∫Øn ch∆∞a ƒë·ªçc
        - B·ªè qua tin nh·∫Øn c·ªßa ch√≠nh user
        - B·ªè qua tin nh·∫Øn ƒë√£ ƒë·ªçc r·ªìi
        - Reset unread count trong participant table
        - C√≥ th·ªÉ ch·ªâ ƒë·ªãnh lastMessageId ƒë·ªÉ ch·ªâ ƒë√°nh d·∫•u ƒë·∫øn tin nh·∫Øn ƒë√≥
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa conversation"
        - name: lastMessageId
          in: query
          required: false
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa tin nh·∫Øn cu·ªëi c√πng c·∫ßn ƒë√°nh d·∫•u ƒë√£ ƒë·ªçc. N·∫øu kh√¥ng c√≥, s·∫Ω ƒë√°nh d·∫•u t·∫•t c·∫£."
      responses:
        '204':
          description: "Conversation marked as read successfully (no content)."
        '400':
          description: "Bad Request - Not a participant in this conversation."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You are not a participant in this conversation"
                requestId: "req-convread001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-convread002"
        '404':
          description: "Conversation not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Conversation not found"
                requestId: "req-convread003"

  /v1/read-receipts/unread-count:
    get:
      summary: "Get global unread count"
      description: |
        L·∫•y t·ªïng s·ªë tin nh·∫Øn ch∆∞a ƒë·ªçc t·ª´ t·∫•t c·∫£ conversations c·ªßa user hi·ªán t·∫°i.
        
        **Use case:** Badge notification tr√™n app icon ho·∫∑c tab.
      tags: [Messages]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Unread count retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Unread count retrieved" }
                  data:
                    type: object
                    properties:
                      unreadCount: { type: integer, format: int64, description: "Total unread messages across all conversations" }
              example:
                success: true
                message: "Unread count retrieved"
                data:
                  unreadCount: 15
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-unread001"

  # --- Call Paths ---
  /v1/calls/initiate:
    post:
      summary: "Initiate a new call"
      description: |
        B·∫Øt ƒë·∫ßu m·ªôt cu·ªôc g·ªçi ƒë·∫øn m·ªôt ng∆∞·ªùi d√πng kh√°c.
        
        **Flow:**
        1. Validate c·∫£ caller v√† callee kh√¥ng busy
        2. T·∫°o Call record v·ªõi status RINGING
        3. Generate Agora token cho caller
        4. Send WebSocket invitation t·ªõi callee
        5. Schedule timeout (30s)
        
        **Note:** User ID c·ªßa caller ƒë∆∞·ª£c l·∫•y t·ª´ JWT token.
      tags: [Call]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InitiateCallRequest' }
            examples:
              audio_call:
                summary: "Audio call"
                value:
                  calleeId: 10
                  callType: "AUDIO"
              video_call:
                summary: "Video call"
                value:
                  calleeId: 15
                  callType: "VIDEO"
      responses:
        '201':
          description: "Call initiated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
              example:
                success: true
                message: "Call initiated"
                data:
                  callInfo:
                    id: "call-uuid-123"
                    channelId: "channel_1734160800000_1_10"
                    status: "RINGING"
                    callType: "VIDEO"
                    callerId: 1
                    callerName: "Nguyen Linh La"
                    callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    calleeId: 10
                    calleeName: "Nguyen Van A"
                    calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    createdAt: "2025-12-14T10:00:00.000Z"
                    durationSeconds: null
                  token: "agora_token_here_for_caller"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                user_busy:
                  summary: "User is busy"
                  value:
                    success: false
                    error:
                      code: "USER_BUSY"
                      message: "User is busy in another call"
                    requestId: "req-call001"
                missing_callee_id:
                  summary: "Missing calleeId"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Callee ID is required"
                    requestId: "req-call002"
                missing_call_type:
                  summary: "Missing callType"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Call type is required"
                    requestId: "req-call003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-call004"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-call005"

  /v1/calls/{callId}/accept:
    post:
      summary: "Accept a call"
      description: |
        Ng∆∞·ªùi nh·∫≠n ch·∫•p nh·∫≠n m·ªôt cu·ªôc g·ªçi ƒë·∫øn.
        
        **Flow:**
        1. Validate user l√† callee
        2. Validate call status l√† RINGING
        3. Update status = CONNECTED
        4. Cancel timeout scheduler
        5. Generate Agora token cho callee
        6. Send WebSocket notification t·ªõi caller
        
        **Note:** Ch·ªâ callee m·ªõi c√≥ th·ªÉ accept call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID c·ªßa call"
          example: "call-uuid-123"
      responses:
        '200':
          description: "Call accepted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
              example:
                success: true
                message: "Call accepted"
                data:
                  callInfo:
                    id: "call-uuid-123"
                    channelId: "channel_1734160800000_1_10"
                    status: "CONNECTED"
                    callType: "VIDEO"
                    callerId: 1
                    callerName: "Nguyen Linh La"
                    callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                    calleeId: 10
                    calleeName: "Nguyen Van A"
                    calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    createdAt: "2025-12-14T10:00:00.000Z"
                    durationSeconds: null
                  token: "agora_token_here_for_callee"
        '400':
          description: "Bad Request - Invalid status."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "INVALID_STATUS"
                  message: "Call is not ringing"
                requestId: "req-accept001"
        '401':
          description: "Unauthorized - Not the callee or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_callee:
                  summary: "Not the callee"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Only callee can accept this call"
                    requestId: "req-accept002"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-accept003"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-accept004"

  /v1/calls/{callId}/reject:
    post:
      summary: "Reject a call"
      description: |
        Ng∆∞·ªùi nh·∫≠n t·ª´ ch·ªëi m·ªôt cu·ªôc g·ªçi ƒë·∫øn.
        
        **Flow:**
        1. Validate user l√† callee
        2. Validate call status l√† RINGING
        3. Update status = REJECTED
        4. Cancel timeout scheduler
        5. Send WebSocket notification t·ªõi caller
        
        **Reasons:** busy, declined, unavailable
        
        **Note:** Ch·ªâ callee m·ªõi c√≥ th·ªÉ reject call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID c·ªßa call"
          example: "call-uuid-123"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RejectCallRequest' }
            examples:
              busy:
                summary: "User is busy"
                value:
                  reason: "busy"
              declined:
                summary: "User declined"
                value:
                  reason: "declined"
              unavailable:
                summary: "User unavailable"
                value:
                  reason: "unavailable"
      responses:
        '200':
          description: "Call rejected successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
              example:
                success: true
                message: "Call rejected"
                data:
                  id: "call-uuid-123"
                  channelId: "channel_1734160800000_1_10"
                  status: "REJECTED"
                  callType: "VIDEO"
                  callerId: 1
                  callerName: "Nguyen Linh La"
                  callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  calleeId: 10
                  calleeName: "Nguyen Van A"
                  calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  createdAt: "2025-12-14T10:00:00.000Z"
                  durationSeconds: null
        '400':
          description: "Bad Request - Invalid status or reason."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_status:
                  summary: "Call not ringing"
                  value:
                    success: false
                    error:
                      code: "INVALID_STATUS"
                      message: "Cannot reject call"
                    requestId: "req-reject001"
                invalid_reason:
                  summary: "Invalid reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Reason must be one of: busy, declined, unavailable"
                    requestId: "req-reject002"
                missing_reason:
                  summary: "Missing reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Reason cannot be blank"
                    requestId: "req-reject003"
        '401':
          description: "Unauthorized - Not the callee or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_callee:
                  summary: "Not the callee"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Only callee can reject this call"
                    requestId: "req-reject004"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-reject005"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-reject006"

  /v1/calls/{callId}/end:
    post:
      summary: "End a call"
      description: |
        M·ªôt trong hai b√™n k·∫øt th√∫c cu·ªôc g·ªçi.
        
        **Flow:**
        1. Validate user l√† caller ho·∫∑c callee
        2. Validate call ch∆∞a ended
        3. Update status = ENDED
        4. Calculate duration
        5. Cancel timeout scheduler
        6. Send WebSocket notification t·ªõi partner
        
        **Reasons:** hangup (default), network error, device error, timeout
        
        **Note:** C·∫£ caller v√† callee ƒë·ªÅu c√≥ th·ªÉ end call.
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string }
          description: "UUID c·ªßa call"
          example: "call-uuid-123"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EndCallRequest' }
            examples:
              normal_hangup:
                summary: "Normal hangup"
                value:
                  reason: "hangup"
              network_error:
                summary: "Network error"
                value:
                  reason: "network error"
              device_error:
                summary: "Device error"
                value:
                  reason: "device error"
              timeout:
                summary: "Timeout"
                value:
                  reason: "timeout"
      responses:
        '200':
          description: "Call ended successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
              example:
                success: true
                message: "Call ended"
                data:
                  id: "call-uuid-123"
                  channelId: "channel_1734160800000_1_10"
                  status: "ENDED"
                  callType: "VIDEO"
                  callerId: 1
                  callerName: "Nguyen Linh La"
                  callerAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/1.png"
                  calleeId: 10
                  calleeName: "Nguyen Van A"
                  calleeAvatar: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  createdAt: "2025-12-14T10:00:00.000Z"
                  durationSeconds: 180
        '400':
          description: "Bad Request - Call already ended or invalid reason."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                already_ended:
                  summary: "Call already ended"
                  value:
                    success: false
                    error:
                      code: "CALL_ALREADY_ENDED"
                      message: "Call already ended"
                    requestId: "req-end001"
                invalid_reason:
                  summary: "Invalid reason"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Reason must be one of: hangup, network error, device error, timeout"
                    requestId: "req-end002"
        '401':
          description: "Unauthorized - Not a participant or invalid token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_participant:
                  summary: "Not a participant"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "You are not a participant of this call"
                    requestId: "req-end003"
                invalid_token:
                  summary: "Invalid token"
                  value:
                    success: false
                    error:
                      code: "UNAUTHORIZED"
                      message: "Invalid or expired token"
                    requestId: "req-end004"
        '404':
          description: "Call not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Call not found"
                requestId: "req-end005"

  # --- Contacts Paths ---
  /v1/contacts:
    get:
      summary: "Get all contacts"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ contacts c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
              example:
                success: true
                message: "Contacts retrieved successfully"
                data:
                  - id: 5
                    contactUserId: 10
                    username: "user10"
                    fullName: "Nguyen Van A"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    nickname: "Best Friend"
                    favorite: true
                    online: true
                    lastSeen: null
                    createdAt: "2025-12-10T10:20:30.456Z"
                  - id: 8
                    contactUserId: 15
                    username: "user15"
                    fullName: "Le Thi C"
                    avatarUrl: null
                    nickname: null
                    favorite: false
                    online: false
                    lastSeen: "2025-12-14T06:30:00.000Z"
                    createdAt: "2025-12-11T14:15:20.123Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-contacts001"
    post:
      summary: "Add a new contact"
      description: "Th√™m m·ªôt contact m·ªõi v√†o danh b·∫°."
      tags: [Contacts]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddContactRequest' }
            example:
              contactUserId: 25
              nickname: "My Colleague"
      responses:
        '201':
          description: "Contact added successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
              example:
                success: true
                message: "Contact added successfully"
                data:
                  id: 12
                  contactUserId: 25
                  username: "user25"
                  fullName: "Pham Van D"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                  nickname: "My Colleague"
                  favorite: false
                  online: true
                  lastSeen: null
                  createdAt: "2025-12-14T09:00:00.000Z"
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                add_yourself:
                  summary: "Cannot add yourself"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot add yourself as contact"
                    requestId: "req-addcontact001"
                already_exists:
                  summary: "Contact already exists"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Contact already exists"
                    requestId: "req-addcontact002"
                missing_user_id:
                  summary: "Missing contactUserId"
                  value:
                    success: false
                    error:
                      code: "VALIDATION_ERROR"
                      message: "Contact user ID is required"
                    requestId: "req-addcontact003"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-addcontact004"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "User not found"
                requestId: "req-addcontact005"

  /v1/contacts/favorites:
    get:
      summary: "Get favorite contacts"
      description: "L·∫•y danh s√°ch contacts y√™u th√≠ch (ƒë√£ ƒë√°nh d·∫•u favorite)."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Favorite contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
              example:
                success: true
                message: "Favorite contacts retrieved successfully"
                data:
                  - id: 5
                    contactUserId: 10
                    username: "user10"
                    fullName: "Nguyen Van A"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                    nickname: "Best Friend"
                    favorite: true
                    online: true
                    lastSeen: null
                    createdAt: "2025-12-10T10:20:30.456Z"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-favcontacts001"

  /v1/contacts/{contactId}:
    put:
      summary: "Update a contact"
      description: "C·∫≠p nh·∫≠t th√¥ng tin contact (nickname, favorite status)."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa contact c·∫ßn update"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateContactRequest' }
            examples:
              update_nickname:
                summary: "Update nickname"
                value:
                  nickname: "New Nickname"
              mark_favorite:
                summary: "Mark as favorite"
                value:
                  isFavorite: true
              update_both:
                summary: "Update both"
                value:
                  nickname: "VIP Friend"
                  isFavorite: true
      responses:
        '200':
          description: "Contact updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
              example:
                success: true
                message: "Contact updated successfully"
                data:
                  id: 5
                  contactUserId: 10
                  username: "user10"
                  fullName: "Nguyen Van A"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/10.png"
                  nickname: "VIP Friend"
                  favorite: true
                  online: true
                  lastSeen: null
                  createdAt: "2025-12-10T10:20:30.456Z"
        '400':
          description: "Bad Request - No access to this contact."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this contact"
                requestId: "req-updatecontact001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-updatecontact002"
        '404':
          description: "Contact not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Contact not found"
                requestId: "req-updatecontact003"
    delete:
      summary: "Delete a contact"
      description: "X√≥a m·ªôt contact kh·ªèi danh b·∫°."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa contact c·∫ßn x√≥a"
      responses:
        '200':
          description: "Contact deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
              example:
                success: true
                message: "Contact deleted successfully"
                data: null
        '400':
          description: "Bad Request - No access to this contact."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this contact"
                requestId: "req-deletecontact001"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-deletecontact002"
        '404':
          description: "Contact not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Contact not found"
                requestId: "req-deletecontact003"

  # --- Friend Requests Paths ---
  /v1/friend-requests:
    post:
      summary: "Send friend request"
      description: |
        G·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n ƒë·∫øn m·ªôt ng∆∞·ªùi d√πng.
        
        **Status Flow:**
        1. PENDING - Request ƒë∆∞·ª£c g·ª≠i, ch·ªù accept/reject
        2. ACCEPTED - Request ƒë∆∞·ª£c ch·∫•p nh·∫≠n, t·∫°o bidirectional contact
        3. REJECTED - Request b·ªã t·ª´ ch·ªëi
        
        **Note:** Kh√¥ng th·ªÉ g·ª≠i request n·∫øu:
        - ƒê√£ c√≥ contact relationship (PENDING/ACCEPTED/BLOCKED)
        - Receiver l√† ch√≠nh m√¨nh
      tags: [Social]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SendFriendRequestRequest' }
            example:
              receiverUserId: 30
              nickname: "Potential Friend"
      responses:
        '201':
          description: "Friend request sent successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/FriendRequestResponse' }
              example:
                success: true
                message: "Friend request sent successfully"
                data:
                  id: 25
                  userId: 30
                  username: "user30"
                  fullName: "Hoang Van E"
                  avatarUrl: null
                  status: "PENDING"
                  nickname: "Potential Friend"
                  online: false
                  requestedAt: "2025-12-14T09:30:00.000Z"
                  acceptedAt: null
                  rejectedAt: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                send_to_yourself:
                  summary: "Cannot send to yourself"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot send friend request to yourself"
                    requestId: "req-friendreq001"
                already_sent:
                  summary: "Already sent"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request already sent"
                    requestId: "req-friendreq002"
                already_friends:
                  summary: "Already friends"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Already friends"
                    requestId: "req-friendreq003"
                user_blocked:
                  summary: "User is blocked"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Cannot send friend request to blocked user"
                    requestId: "req-friendreq004"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreq005"
        '404':
          description: "User not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Receiver not found"
                requestId: "req-friendreq006"

  /v1/friend-requests/received:
    get:
      summary: "Get pending friend requests received"
      description: |
        L·∫•y danh s√°ch l·ªùi m·ªùi k·∫øt b·∫°n m√† user hi·ªán t·∫°i ƒë√£ nh·∫≠n (ch∆∞a accept/reject).
        
        **Use case:** Hi·ªÉn th·ªã notification "X wants to be your friend"
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Pending requests retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FriendRequestResponse'
              example:
                success: true
                message: "Pending requests retrieved successfully"
                data:
                  - id: 20
                    userId: 25
                    username: "user25"
                    fullName: "Pham Van D"
                    avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                    status: "PENDING"
                    nickname: null
                    online: true
                    requestedAt: "2025-12-14T08:00:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
                  - id: 22
                    userId: 28
                    username: "user28"
                    fullName: "Nguyen Thi F"
                    avatarUrl: null
                    status: "PENDING"
                    nickname: null
                    online: false
                    requestedAt: "2025-12-14T07:30:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreqrecv001"

  /v1/friend-requests/sent:
    get:
      summary: "Get pending friend requests sent"
      description: |
        L·∫•y danh s√°ch l·ªùi m·ªùi k·∫øt b·∫°n m√† user hi·ªán t·∫°i ƒë√£ g·ª≠i (ch∆∞a ƒë∆∞·ª£c accept/reject).
        
        **Use case:** Hi·ªÉn th·ªã danh s√°ch "Pending requests" ƒë·ªÉ c√≥ th·ªÉ cancel
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Sent requests retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FriendRequestResponse'
              example:
                success: true
                message: "Sent requests retrieved successfully"
                data:
                  - id: 18
                    userId: 22
                    username: "user22"
                    fullName: "Tran Van G"
                    avatarUrl: null
                    status: "PENDING"
                    nickname: "Work Colleague"
                    online: false
                    requestedAt: "2025-12-14T06:00:00.000Z"
                    acceptedAt: null
                    rejectedAt: null
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-friendreqsent001"

  /v1/friend-requests/{requestId}/accept:
    post:
      summary: "Accept friend request"
      description: |
        Ch·∫•p nh·∫≠n l·ªùi m·ªùi k·∫øt b·∫°n.
        
        **Action:**
        - Set request status = ACCEPTED
        - T·∫°o reverse contact (bidirectional friendship)
        - Both users become friends
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa friend request c·∫ßn accept"
      responses:
        '200':
          description: "Friend request accepted successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data: { $ref: '#/components/schemas/FriendRequestResponse' }
              example:
                success: true
                message: "Friend request accepted successfully"
                data:
                  id: 20
                  userId: 25
                  username: "user25"
                  fullName: "Pham Van D"
                  avatarUrl: "https://res.cloudinary.com/dk3gud5kq/image/upload/v1765476687/avatars/25.png"
                  status: "ACCEPTED"
                  nickname: null
                  online: true
                  requestedAt: "2025-12-14T08:00:00.000Z"
                  acceptedAt: "2025-12-14T09:45:00.000Z"
                  rejectedAt: null
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_receiver:
                  summary: "Not the receiver"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the receiver of this request"
                    requestId: "req-acceptreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-acceptreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-acceptreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-acceptreq004"

  /v1/friend-requests/{requestId}/reject:
    post:
      summary: "Reject friend request"
      description: |
        T·ª´ ch·ªëi l·ªùi m·ªùi k·∫øt b·∫°n.
        
        **Action:**
        - Set request status = REJECTED
        - Keep the record for history (not deleted)
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa friend request c·∫ßn reject"
      responses:
        '204':
          description: "Friend request rejected successfully (no content)."
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_receiver:
                  summary: "Not the receiver"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the receiver of this request"
                    requestId: "req-rejectreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-rejectreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-rejectreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-rejectreq004"

  /v1/friend-requests/{requestId}:
    delete:
      summary: "Cancel friend request"
      description: |
        H·ªßy l·ªùi m·ªùi k·∫øt b·∫°n ƒë√£ g·ª≠i (ch·ªâ sender m·ªõi c√≥ th·ªÉ cancel).
        
        **Action:**
        - Delete the request record completely
        - Only PENDING requests can be cancelled
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa friend request c·∫ßn cancel"
      responses:
        '204':
          description: "Friend request cancelled successfully (no content)."
        '400':
          description: "Bad Request - Validation failed."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                not_sender:
                  summary: "Not the sender"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "You are not the sender of this request"
                    requestId: "req-cancelreq001"
                not_pending:
                  summary: "Request not pending"
                  value:
                    success: false
                    error:
                      code: "BAD_REQUEST"
                      message: "Friend request is not pending"
                    requestId: "req-cancelreq002"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "req-cancelreq003"
        '404':
          description: "Request not found."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: "RESOURCE_NOT_FOUND"
                  message: "Friend request not found"
                requestId: "req-cancelreq004"

  # --- Messenger Notes Paths ---
  /v1/notes:
    post:
      summary: "Create or update note"
      description: |
        T·∫°o ho·∫∑c c·∫≠p nh·∫≠t note (status) c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i.
        - M·ªói user ch·ªâ c√≥ 1 note active t·∫°i m·ªôt th·ªùi ƒëi·ªÉm
        - Note t·ª± ƒë·ªông expire sau 24 gi·ªù
        - T·ªëi ƒëa 60 k√Ω t·ª±
      tags: [Notes]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UserNoteRequest' }
      responses:
        '201':
          description: "Note created successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
    delete:
      summary: "Delete current user's note"
      description: "X√≥a note c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/me:
    get:
      summary: "Get current user's note"
      description: "L·∫•y note c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i (n·∫øu c√≥)."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/contacts:
    get:
      summary: "Get notes from contacts"
      description: "L·∫•y t·∫•t c·∫£ notes ƒëang active t·ª´ danh s√°ch contacts c·ªßa user. Hi·ªÉn th·ªã trong inbox/chat list."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Notes retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteListResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/users/{userId}:
    get:
      summary: "Get a specific user's note"
      description: "L·∫•y note c·ªßa m·ªôt user c·ª• th·ªÉ. Ch·ªâ xem ƒë∆∞·ª£c note c·ªßa contacts."
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Note retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact."
        '404':
          description: "User not found or no active note."

  /v1/notes/{noteId}/reply:
    post:
      summary: "Reply to a note"
      description: |
        Reply v√†o m·ªôt note. Reply s·∫Ω t·∫°o m·ªôt tin nh·∫Øn TEXT trong direct conversation gi·ªØa 2 ng∆∞·ªùi.
        - Reply l√† message th·∫≠t trong conversation
        - C√≥ th·ªÉ reply nhi·ªÅu l·∫ßn
        - Ch·ªâ contacts m·ªõi reply ƒë∆∞·ª£c
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NoteReplyRequest' }
      responses:
        '201':
          description: "Reply sent successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact or replying to own note."
        '404':
          description: "Note not found or expired."

  /v1/notes/{noteId}/react:
    post:
      summary: "React to a note with emoji"
      description: |
        React v√†o m·ªôt note v·ªõi emoji. Reaction s·∫Ω t·∫°o m·ªôt tin nh·∫Øn TEXT v·ªõi n·ªôi dung l√† emoji trong direct conversation.
        - M·ªói reaction l√† 1 message ri√™ng
        - C√≥ th·ªÉ react nhi·ªÅu l·∫ßn v·ªõi emojis kh√°c nhau
        - Ch·ªâ contacts m·ªõi react ƒë∆∞·ª£c
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NoteReactRequest' }
      responses:
        '200':
          description: "Reaction sent successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact."
        '404':
          description: "Note not found or expired."

  /v1/notes/{noteId}/messages:
    get:
      summary: "Get all messages for a note"
      description: |
        L·∫•y t·∫•t c·∫£ messages (replies + reactions) li√™n quan ƒë·∫øn m·ªôt note.
        - Ch·ªâ note owner m·ªõi xem ƒë∆∞·ª£c
        - Tr·∫£ v·ªÅ danh s√°ch messages t·ª´ conversation
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Messages retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageListResponse' }
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Only note owner can view."
        '404':
          description: "Note not found or expired."

