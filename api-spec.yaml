openapi: 3.0.1
info:
  title: Chattrix API
  description: |
    API to√†n di·ªán cho ·ª©ng d·ª•ng Chattrix, bao g·ªìm x√°c th·ª±c, qu·∫£n l√Ω ng∆∞·ªùi d√πng, v√† t√≠nh nƒÉng g·ªçi ƒëi·ªán th·ªùi gian th·ª±c.

    ---

    ### Chi ti·∫øt c√°c s·ª± ki·ªán WebSocket
    T·∫•t c·∫£ c√°c tin nh·∫Øn t·ª´ server ƒë·ªÅu ƒë∆∞·ª£c b·ªçc trong m·ªôt ƒë·ªëi t∆∞·ª£ng `WebSocketMessage` chung.
    *   **`chat.message`**: Tin nh·∫Øn tr√≤ chuy·ªán m·ªõi. (Payload: `OutgoingMessageDto`)
    *   **`message.updated`**: M·ªôt tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t. (Payload: `MessageUpdateDto`)
    *   **`message.deleted`**: M·ªôt tin nh·∫Øn ƒë√£ b·ªã x√≥a. (Payload: `MessageDeleteDto`)
    *   **`conversation.update`**: Th√¥ng tin cu·ªôc tr√≤ chuy·ªán ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t (v√≠ d·ª•: tin nh·∫Øn cu·ªëi c√πng). (Payload: `ConversationUpdateDto`)
    *   **`user.status`**: Tr·∫°ng th√°i tr·ª±c tuy·∫øn c·ªßa ng∆∞·ªùi d√πng ƒë√£ thay ƒë·ªïi. (Payload: `UserStatusDto`)
    *   **`note.created`**: Note m·ªõi ƒë∆∞·ª£c t·∫°o t·ª´ contact. (Payload: `UserNoteDto`)
    *   **`note.updated`**: Note c·ªßa contact ƒë∆∞·ª£c c·∫≠p nh·∫≠t. (Payload: `UserNoteDto`)
    *   **`note.deleted`**: Note c·ªßa contact b·ªã x√≥a. (Payload: `NoteDeleteDto`)
    *   **`call.incoming`**: Th√¥ng b√°o c√≥ cu·ªôc g·ªçi ƒë·∫øn. (Payload: `CallInvitationDto`)
    *   **`call.accepted`**: Cu·ªôc g·ªçi ƒë√£ ƒë∆∞·ª£c ch·∫•p nh·∫≠n. (Payload: `CallAcceptDto`)
    *   **`call.rejected`**: Cu·ªôc g·ªçi ƒë√£ b·ªã t·ª´ ch·ªëi. (Payload: `CallRejectDto`)
    *   **`call.ended`**: Cu·ªôc g·ªçi ƒë√£ k·∫øt th√∫c. (Payload: `CallEndDto`)
    *   **`call.timeout`**: Cu·ªôc g·ªçi h·∫øt th·ªùi gian ch·ªù. (Payload: `CallTimeoutDto`)
    *   **`call.quality_warning`**: C·∫£nh b√°o ch·∫•t l∆∞·ª£ng k·∫øt n·ªëi. (Payload: `CallQualityWarningDto`)
  version: "1.0.0"
servers:
  - url: /api
    description: Server API ch√≠nh

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    # --- Auth & User Schemas ---
    LoginRequest:
      type: object
      required: [usernameOrEmail, password]
      properties:
        usernameOrEmail: { type: string, description: "T√™n ƒëƒÉng nh·∫≠p ho·∫∑c email c·ªßa ng∆∞·ªùi d√πng." }
        password: { type: string, format: password, description: "M·∫≠t kh·∫©u." }

    RegisterRequest:
      type: object
      required: [username, email, password, fullName]
      properties:
        username: { type: string, description: "T√™n ƒëƒÉng nh·∫≠p m·ªõi." }
        email: { type: string, format: email, description: "Email c·ªßa ng∆∞·ªùi d√πng." }
        password: { type: string, format: password, description: "M·∫≠t kh·∫©u." }
        fullName: { type: string, description: "H·ªç v√† t√™n ƒë·∫ßy ƒë·ªß." }

    RefreshTokenRequest:
      type: object
      required: [refreshToken]
      properties:
        refreshToken: { type: string, description: "Refresh token nh·∫≠n ƒë∆∞·ª£c khi ƒëƒÉng nh·∫≠p." }
    
    AuthResponse:
      type: object
      properties:
        accessToken: { type: string, description: "Token truy c·∫≠p ch√≠nh." }
        refreshToken: { type: string, description: "Token d√πng ƒë·ªÉ l√†m m·ªõi access token." }
        tokenType: { type: string, example: "Bearer" }
        expiresIn: { type: integer, format: int64, description: "Th·ªùi gian h·∫øt h·∫°n c·ªßa access token (t√≠nh b·∫±ng gi√¢y)." }

    UserResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        username: { type: string }
        email: { type: string, format: email }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        isOnline: { type: boolean }
        lastSeen: { type: string, format: date-time, nullable: true }

    # --- Message Schemas ---
    MessageResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        senderId: { type: integer, format: int64 }
        senderUsername: { type: string, nullable: true }
        senderName: { type: string, nullable: true }
        senderAvatarUrl: { type: string, format: uri, nullable: true }
        content: { type: string, nullable: true }
        type: { type: string, description: "Message type (TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION, etc)" }
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }
        reactions:
          type: object
          description: "Map of reaction (emoji or short key) to array of userIds or counts. Implementation may vary."
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
        sentAt: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time, nullable: true }
        forwardCount: { type: integer, format: int32, default: 0 }
        forwarded: { type: boolean, default: false }
        deleted: { type: boolean, default: false }
        edited: { type: boolean, default: false }

    ChatMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string }
        type: { type: string, enum: [TEXT, IMAGE, VIDEO, AUDIO, FILE, LOCATION], default: TEXT }
        replyToMessageId: { type: integer, format: int64, nullable: true }
        mentions:
          type: array
          items:
            type: integer
            format: int64
        mediaUrl: { type: string, format: uri, nullable: true }
        thumbnailUrl: { type: string, format: uri, nullable: true }
        fileName: { type: string, nullable: true }
        fileSize: { type: integer, format: int64, nullable: true }
        duration: { type: integer, nullable: true }
        latitude: { type: number, format: double, nullable: true }
        longitude: { type: number, format: double, nullable: true }
        locationName: { type: string, nullable: true }

    UpdateMessageRequest:
      type: object
      required: [content]
      properties:
        content: { type: string, description: "N·ªôi dung m·ªõi c·ªßa tin nh·∫Øn." }

    # --- Call Schemas ---
    CallResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        channelId: { type: string }
        status: { type: string, enum: [RINGING, CONNECTING, CONNECTED, REJECTED, ENDED, INITIATING] }
        callType: { type: string, enum: [AUDIO, VIDEO] }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri, nullable: true }
        calleeId: { type: integer, format: int64 }
        calleeName: { type: string }
        calleeAvatar: { type: string, format: uri, nullable: true }
        createdAt: { type: string, format: date-time }
        durationSeconds: { type: integer, nullable: true }

    CallConnectionResponse:
      type: object
      properties:
        callInfo: { $ref: '#/components/schemas/CallResponse' }
        token: { type: string, description: "Token (v√≠ d·ª•: Agora Token) ƒë·ªÉ k·∫øt n·ªëi v√†o phi√™n g·ªçi." }

    # --- Generic API Response Wrappers ---
    ApiResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { nullable: true }

    ApiResponse_AuthResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/AuthResponse' }

    ApiResponse_UserResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserResponse' }
    
    ApiResponse_UserListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'

    ApiResponse_MessageResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageResponse' }

    ApiResponse_MessageListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/MessageResponse'

    ApiResponse_CallConnectionResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallConnectionResponse' }

    ApiResponse_CallResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/CallResponse' }

    # --- Request Schemas ---
    InitiateCallRequest:
      type: object
      required: [calleeId, callType]
      properties:
        calleeId: { type: integer, format: int64 }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    RejectCallRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, enum: [busy, declined, unavailable] }

    EndCallRequest:
      type: object
      properties:
        reason: { type: string, enum: [hangup, "network error", "device error", timeout], default: "hangup" }

    # --- WebSocket DTOs ---
    MessageUpdateDto:
      type: object
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }
        content: { type: string }
        isEdited: { type: boolean }
        updatedAt: { type: string, format: date-time }

    MessageDeleteDto:
      type: object
      properties:
        messageId: { type: integer, format: int64 }
        conversationId: { type: integer, format: int64 }

    CallInvitationDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        channelId: { type: string }
        callerId: { type: integer, format: int64 }
        callerName: { type: string }
        callerAvatar: { type: string, format: uri }
        callType: { type: string, enum: [AUDIO, VIDEO] }

    CallAcceptDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        acceptedBy: { type: integer, format: int64 }

    CallRejectDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        rejectedBy: { type: integer, format: int64 }
        reason: { type: string, enum: [busy, declined, unavailable] }

    CallEndDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        endedBy: { type: integer, format: int64 }
        durationSeconds: { type: integer }

    CallTimeoutDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        reason: { type: string, example: "no_answer" }

    CallQualityWarningDto:
      type: object
      properties:
        callId: { type: string, format: uuid }
        userId: { type: integer, format: int64 }
        message: { type: string }

    # --- Contacts & Social Schemas ---
    ContactResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        contactUserId: { type: integer, format: int64 }
        contactUser: { $ref: '#/components/schemas/UserResponse' }
        nickname: { type: string, nullable: true }
        isFavorite: { type: boolean }
        status: { type: string, enum: [PENDING, ACCEPTED, BLOCKED] }
        createdAt: { type: string, format: date-time }

    AddContactRequest:
      type: object
      required: [contactUserId]
      properties:
        contactUserId: { type: integer, format: int64 }
        nickname: { type: string, nullable: true }

    UpdateContactRequest:
      type: object
      properties:
        nickname: { type: string, nullable: true }
        isFavorite: { type: boolean, nullable: true }

    SendFriendRequestRequest:
      type: object
      required: [receiverId]
      properties:
        receiverId: { type: integer, format: int64 }

    # --- Read Receipts Schemas ---
    ReadReceiptResponse:
      type: object
      properties:
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        readAt: { type: string, format: date-time }

    # --- Reaction Schemas ---
    AddReactionRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10 }

    MessageReactionsResponse:
      type: object
      properties:
        messageId: { type: integer, format: int64 }
        reactions:
          type: object
          additionalProperties:
            type: array
            items:
              type: integer
              format: int64
          description: "Map of emoji to array of user IDs. Example: {'üëç': [1, 2, 3], '‚ù§Ô∏è': [4, 5]}"

    # --- Conversation Members Schemas ---
    ConversationParticipantResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        user: { $ref: '#/components/schemas/UserResponse' }
        role: { type: string, enum: [ADMIN, MEMBER] }
        joinedAt: { type: string, format: date-time }
        unreadCount: { type: integer }

    AddMembersRequest:
      type: object
      required: [userIds]
      properties:
        userIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateMemberRoleRequest:
      type: object
      required: [role]
      properties:
        role: { type: string, enum: [ADMIN, MEMBER] }

    # --- Conversation Schemas ---
    ConversationResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        name: { type: string, nullable: true, description: "T√™n conversation (ch·ªâ c√≥ trong GROUP)" }
        type: { type: string, enum: [DIRECT, GROUP] }
        avatarUrl: { type: string, format: uri, nullable: true, description: "Avatar URL (ch·ªâ c√≥ trong GROUP)" }
        participants:
          type: array
          items:
            type: object
            properties:
              userId: { type: integer, format: int64 }
              username: { type: string }
              role: { type: string, enum: [ADMIN, MEMBER] }
          description: "Danh s√°ch participants v·ªõi userId, username v√† role"
        lastMessage:
          oneOf:
            - $ref: '#/components/schemas/MessageResponse'
            - type: "null"
          description: "Last message in the conversation, or null if empty."
        unreadCount: { type: integer, description: "S·ªë tin nh·∫Øn ch∆∞a ƒë·ªçc (optional)" }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      example:
        id: 5
        name: null
        type: "GROUP"
        avatarUrl: null
        createdAt: "2025-12-12T09:39:16.600310058Z"
        updatedAt: "2025-12-12T09:39:16.600312653Z"
        participants:
          - userId: 12
            username: "hungly"
            role: "ADMIN"
          - userId: 2
            username: "binhtran"
            role: "MEMBER"
          - userId: 3
            username: "hoale"
            role: "MEMBER"

    CreateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        type: { type: string, enum: [DIRECT, GROUP], default: DIRECT }
        participantIds:
          type: array
          items:
            type: integer
            format: int64

    UpdateConversationRequest:
      type: object
      properties:
        name: { type: string, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }

    # --- User Profile Schemas ---
    UpdateProfileRequest:
      type: object
      properties:
        fullName: { type: string, nullable: true }
        bio: { type: string, maxLength: 500, nullable: true }
        avatarUrl: { type: string, format: uri, nullable: true }
        phone: { type: string, nullable: true }
        dateOfBirth: { type: string, format: date, nullable: true }
        gender: { type: string, enum: [MALE, FEMALE, OTHER], nullable: true }
        location: { type: string, nullable: true }

    # --- API Response Wrappers ---
    ApiResponse_ContactResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ContactResponse' }

    ApiResponse_ContactListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ContactResponse'

    ApiResponse_ReadReceiptListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ReadReceiptResponse'

    ApiResponse_MessageReactionsResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/MessageReactionsResponse' }

    ApiResponse_ConversationResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/ConversationResponse' }

    ApiResponse_ConversationListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConversationResponse'

    ApiResponse_ParticipantListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/ConversationParticipantResponse'

    # --- Messenger Notes Schemas ---
    UserNoteRequest:
      type: object
      required: [noteText]
      properties:
        noteText:
          type: string
          maxLength: 60
          description: "N·ªôi dung note (t·ªëi ƒëa 60 k√Ω t·ª±)."
        musicUrl:
          type: string
          format: uri
          nullable: true
          description: "URL nh·∫°c ƒë√≠nh k√®m (optional)."
        musicTitle:
          type: string
          maxLength: 100
          nullable: true
          description: "T√™n b√†i nh·∫°c (optional)."
        emoji:
          type: string
          maxLength: 10
          nullable: true
          description: "Emoji ƒë·∫°i di·ªán (optional)."

    UserNoteResponse:
      type: object
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        username: { type: string }
        fullName: { type: string }
        avatarUrl: { type: string, format: uri, nullable: true }
        noteText: { type: string, maxLength: 60 }
        musicUrl: { type: string, format: uri, nullable: true }
        musicTitle: { type: string, nullable: true }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time, description: "Note t·ª± ƒë·ªông x√≥a sau 24h." }
        replyCount: { type: integer, format: int64, description: "T·ªïng s·ªë messages (replies + reactions)." }

    NoteReplyRequest:
      type: object
      required: [replyText]
      properties:
        replyText: { type: string, description: "N·ªôi dung reply." }

    NoteReactRequest:
      type: object
      required: [emoji]
      properties:
        emoji: { type: string, maxLength: 10, description: "Emoji reaction." }

    UserNoteDto:
      type: object
      description: "WebSocket payload cho note events."
      properties:
        id: { type: integer, format: int64 }
        userId: { type: integer, format: int64 }
        noteText: { type: string }
        emoji: { type: string, nullable: true }
        createdAt: { type: string, format: date-time }
        expiresAt: { type: string, format: date-time }

    NoteDeleteDto:
      type: object
      properties:
        userId: { type: integer, format: int64 }

    ApiResponse_UserNoteResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data: { $ref: '#/components/schemas/UserNoteResponse' }

    ApiResponse_UserNoteListResponse:
      type: object
      properties:
        success: { type: boolean, example: true }
        message: { type: string }
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserNoteResponse'

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: "C√°c API li√™n quan ƒë·∫øn x√°c th·ª±c, ƒëƒÉng nh·∫≠p, ƒëƒÉng k√Ω v√† qu·∫£n l√Ω phi√™n l√†m vi·ªác."
  - name: Users
    description: "C√°c API li√™n quan ƒë·∫øn qu·∫£n l√Ω ng∆∞·ªùi d√πng."
  - name: Conversations
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω cu·ªôc tr√≤ chuy·ªán."
  - name: Messages
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω tin nh·∫Øn trong cu·ªôc tr√≤ chuy·ªán."
  - name: Notes
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω Messenger Notes (status 24h tr√™n avatar)."
  - name: Contacts
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω danh b·∫° v√† b·∫°n b√®."
  - name: Social
    description: "C√°c API cho t√≠nh nƒÉng x√£ h·ªôi (friend requests, etc)."
  - name: Call
    description: "C√°c API ƒë·ªÉ qu·∫£n l√Ω t√≠nh nƒÉng g·ªçi ƒëi·ªán."

paths:
  # --- Auth Paths ---
  /v1/auth/register:
    post:
      summary: "User Registration"
      description: "ƒêƒÉng k√Ω m·ªôt t√†i kho·∫£n ng∆∞·ªùi d√πng m·ªõi."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RegisterRequest' }
      responses:
        '201':
          description: "Registration successful."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
        '400':
          description: "Bad Request (e.g., invalid input, username/email already exists)."

  /v1/auth/login:
    post:
      summary: "User Login"
      description: "X√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng username/email v√† password ƒë·ªÉ nh·∫≠n v·ªÅ access token v√† refresh token."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        '200':
          description: "Login successful."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
        '400':
          description: "Bad Request (e.g., invalid credentials)."
        '401':
          description: "Unauthorized (e.g., account not verified)."

  /v1/auth/refresh:
    post:
      summary: "Refresh Access Token"
      description: "S·ª≠ d·ª•ng refresh token ƒë·ªÉ l·∫•y m·ªôt access token m·ªõi."
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RefreshTokenRequest' }
      responses:
        '200':
          description: "Token refreshed successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_AuthResponse' }
        '401':
          description: "Unauthorized (e.g., invalid or expired refresh token)."

  /v1/auth/me:
    get:
      summary: "Get Current User Info"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa ng∆∞·ªùi d√πng ƒëang ƒëƒÉng nh·∫≠p, d·ª±a tr√™n token x√°c th·ª±c."
      tags: [Authentication]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "User retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."

  # --- User Paths ---
  /v1/users:
    get:
      summary: "Get All Users"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ ng∆∞·ªùi d√πng trong h·ªá th·ªëng. Y√™u c·∫ßu x√°c th·ª±c."
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Users retrieved successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_UserListResponse'
        '401':
          description: "Unauthorized."

  /v1/users/search:
    get:
      summary: "Search users"
      description: "T√¨m ki·∫øm ng∆∞·ªùi d√πng theo username, email ho·∫∑c t√™n."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: query
          in: query
          required: true
          schema: { type: string }
          description: "T·ª´ kh√≥a t√¨m ki·∫øm."
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
          description: "S·ªë l∆∞·ª£ng k·∫øt qu·∫£ t·ªëi ƒëa."
      responses:
        '200':
          description: "Users found successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserListResponse' }
        '401':
          description: "Unauthorized."

  /v1/profile/me:
    get:
      summary: "Get my profile"
      description: "L·∫•y th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
    put:
      summary: "Update my profile"
      description: "C·∫≠p nh·∫≠t th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateProfileRequest' }
      responses:
        '200':
          description: "Profile updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."

  /v1/profile/{userId}:
    get:
      summary: "Get user profile by ID"
      description: "L·∫•y th√¥ng tin profile c·ªßa m·ªôt ng∆∞·ªùi d√πng c·ª• th·ªÉ."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "User not found."

  /v1/profile/username/{username}:
    get:
      summary: "Get user profile by username"
      description: "L·∫•y th√¥ng tin profile c·ªßa ng∆∞·ªùi d√πng theo username."
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: "Profile retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "User not found."

  # --- Conversation Paths ---
  /v1/conversations:
    post:
      summary: "Create a new conversation"
      description: |
        T·∫°o m·ªôt cu·ªôc tr√≤ chuy·ªán m·ªõi (1-1 ho·∫∑c nh√≥m).
        
        **VALIDATION RULES:**
        - **DIRECT**: PH·∫¢I c√≥ ƒë√∫ng 1 participant kh√°c (ngo√†i current user)
          - ‚ùå WRONG: participantIds: [17, 18, 19] (3 ng∆∞·ªùi)
          - ‚úÖ CORRECT: participantIds: [17] (1 ng∆∞·ªùi)
          
        - **GROUP**: PH·∫¢I c√≥ √≠t nh·∫•t 1 participant kh√°c (ngo√†i current user)
          - ‚úÖ CORRECT: participantIds: [17, 18] (2+ ng∆∞·ªùi)
          - ‚úÖ CORRECT: participantIds: [17] (1 ng∆∞·ªùi, nh∆∞ng n√™n d√πng DIRECT thay v√¨ GROUP)
        
        **Note**: Current user t·ª± ƒë·ªông ƒë∆∞·ª£c th√™m v√†o conversation, kh√¥ng c·∫ßn ƒë∆∞a v√†o participantIds.
      tags: [Conversations]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateConversationRequest' }
            examples:
              direct:
                summary: "Direct conversation (1-1) - CORRECT"
                value:
                  type: "DIRECT"
                  participantIds: [17]
              direct_wrong:
                summary: "Direct conversation - WRONG (multiple participants)"
                value:
                  type: "DIRECT"
                  participantIds: [17, 18, 19]
              group:
                summary: "Group conversation - CORRECT"
                value:
                  name: "Team Chat"
                  type: "GROUP"
                  participantIds: [17, 18, 19]
      responses:
        '201':
          description: "Conversation created successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation created successfully"
                data:
                  id: 5
                  name: null
                  type: "GROUP"
                  avatarUrl: null
                  createdAt: "2025-12-12T09:39:16.600310058Z"
                  updatedAt: "2025-12-12T09:39:16.600312653Z"
                  participants:
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 2
                      username: "binhtran"
                      role: "MEMBER"
                    - userId: 3
                      username: "hoale"
                      role: "MEMBER"
                    - userId: 4
                      username: "tuanpham"
                      role: "MEMBER"
                    - userId: 5
                      username: "thuyvo"
                      role: "MEMBER"
        '400':
          description: |
            Bad Request:
            - "DIRECT conversation must have exactly 1 other participant. Found: X"
            - "GROUP conversation must have at least 1 other participant"
            - "At least one participant is required"
            - "Participant not found: {id}"
        '401':
          description: "Unauthorized."
    get:
      summary: "Get all conversations"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ cu·ªôc tr√≤ chuy·ªán c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i, s·∫Øp x·∫øp theo tin nh·∫Øn m·ªõi nh·∫•t. H·ªó tr·ª£ filter theo lo·∫°i conversation."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: filter
          in: query
          required: false
          description: |
            Filter conversations by type:
            - **all** (default): T·∫•t c·∫£ conversations
            - **unread**: Ch·ªâ conversations c√≥ tin nh·∫Øn ch∆∞a ƒë·ªçc
            - **group**: Ch·ªâ conversations nh√≥m (GROUP)
          schema:
            type: string
            enum: [all, unread, group]
            default: all
          example: all
      responses:
        '200':
          description: "Conversations retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationListResponse' }
              examples:
                all:
                  summary: "All conversations (filter=all)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 1
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:35:09.382687Z"
                        updatedAt: "2025-12-13T07:38:26.471576Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                        lastMessage:
                          id: 6
                          content: "ƒë√£ s·ª≠a nha"
                          senderId: 12
                          senderUsername: "hungly"
                          sentAt: "2025-12-13T07:38:26.438210Z"
                          type: "TEXT"
                      - id: 5
                        type: "GROUP"
                        createdAt: "2025-12-12T09:39:16.600310Z"
                        updatedAt: "2025-12-12T09:39:16.600313Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 3
                            username: "hoale"
                            role: "MEMBER"
                          - userId: 4
                            username: "tuanpham"
                            role: "MEMBER"
                          - userId: 2
                            username: "binhtran"
                            role: "MEMBER"
                          - userId: 5
                            username: "thuyvo"
                            role: "MEMBER"
                      - id: 4
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:38:52.749391Z"
                        updatedAt: "2025-12-12T09:38:52.749395Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                unread:
                  summary: "Only unread conversations (filter=unread)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 1
                        type: "DIRECT"
                        createdAt: "2025-12-12T09:35:09.382687Z"
                        updatedAt: "2025-12-13T07:38:26.471576Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 17
                            username: "ducphan"
                            role: "MEMBER"
                        lastMessage:
                          id: 6
                          content: "ƒë√£ s·ª≠a nha"
                          senderId: 12
                          senderUsername: "hungly"
                          sentAt: "2025-12-13T07:38:26.438210Z"
                          type: "TEXT"
                group:
                  summary: "Only group conversations (filter=group)"
                  value:
                    success: true
                    message: "Conversations retrieved successfully"
                    data:
                      - id: 5
                        type: "GROUP"
                        createdAt: "2025-12-12T09:39:16.600310Z"
                        updatedAt: "2025-12-12T09:39:16.600313Z"
                        participants:
                          - userId: 12
                            username: "hungly"
                            role: "ADMIN"
                          - userId: 3
                            username: "hoale"
                            role: "MEMBER"
                          - userId: 4
                            username: "tuanpham"
                            role: "MEMBER"
                          - userId: 2
                            username: "binhtran"
                            role: "MEMBER"
                          - userId: 5
                            username: "thuyvo"
                            role: "MEMBER"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid, example: "27fcc299-9b9b-4cfd-a87f-82260d7fc124" }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"

  /v1/conversations/{conversationId}:
    get:
      summary: "Get a conversation"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt cu·ªôc tr√≤ chuy·ªán, bao g·ªìm participants v√† last message."
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 1
      responses:
        '200':
          description: "Conversation retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation retrieved successfully"
                data:
                  id: 1
                  type: "DIRECT"
                  createdAt: "2025-12-12T09:35:09.382687Z"
                  updatedAt: "2025-12-13T07:38:26.471576Z"
                  participants:
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 17
                      username: "ducphan"
                      role: "MEMBER"
                  lastMessage:
                    id: 6
                    content: "ƒë√£ s·ª≠a nha"
                    senderId: 12
                    senderUsername: "hungly"
                    sentAt: "2025-12-13T07:38:26.438210Z"
                    type: "TEXT"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid, example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890" }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid, example: "27fcc299-9b9b-4cfd-a87f-82260d7fc124" }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid, example: "783376db-aad3-4ae8-9886-9074a79356d0" }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "783376db-aad3-4ae8-9886-9074a79356d0"
    put:
      summary: "Update a conversation"
      description: |
        C·∫≠p nh·∫≠t th√¥ng tin cu·ªôc tr√≤ chuy·ªán (t√™n, avatar).
        - Ch·ªâ admin m·ªõi ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong group chat
        - Kh√¥ng th·ªÉ update direct conversation
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateConversationRequest' }
            example:
              name: "day la group"
              avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
      responses:
        '200':
          description: "Conversation updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ConversationResponse' }
              example:
                success: true
                message: "Conversation updated successfully"
                data:
                  id: 7
                  type: "GROUP"
                  name: "day la group"
                  avatarUrl: "http://TDBUQDLVNCWK.hiynU7F27tcNxQSUu-RDCu0"
                  createdAt: "2025-12-13T09:14:14.522996Z"
                  updatedAt: "2025-12-13T09:14:14.522999Z"
                  participants:
                    - userId: 5
                      username: "thuyvo"
                      role: "MEMBER"
                    - userId: 4
                      username: "tuanpham"
                      role: "MEMBER"
                    - userId: 6
                      username: "thanhdang"
                      role: "MEMBER"
                    - userId: 12
                      username: "hungly"
                      role: "ADMIN"
                    - userId: 2
                      username: "binhtran"
                      role: "MEMBER"
                    - userId: 3
                      username: "hoale"
                      role: "MEMBER"
        '400':
          description: "Bad Request - Validation failed or no access."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "b1c2d3e4-f5a6-7890-bcde-f12345678901"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '403':
          description: "Forbidden - Only admin can update."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "FORBIDDEN" }
                      message: { type: string, example: "Only admin can update group conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "FORBIDDEN"
                  message: "Only admin can update group conversation"
                requestId: "c2d3e4f5-a6b7-8901-cdef-234567890abc"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "d3e4f5a6-b7c8-9012-def0-34567890abcd"
    delete:
      summary: "Delete a conversation"
      description: |
        X√≥a m·ªôt cu·ªôc tr√≤ chuy·ªán (user r·ªùi kh·ªèi conversation).
        - User s·∫Ω b·ªã remove kh·ªèi participants list
        - C√≥ th·ªÉ √°p d·ª•ng cho c·∫£ DIRECT v√† GROUP conversation
        - Conversation v·∫´n t·ªìn t·∫°i cho c√°c participants kh√°c
      tags: [Conversations]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
          example: 7
      responses:
        '200':
          description: "Conversation deleted successfully (user left the conversation)."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Conversation deleted successfully" }
              example:
                success: true
                message: "Conversation deleted successfully"
        '400':
          description: "Bad Request - You do not have access to this conversation."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "BAD_REQUEST" }
                      message: { type: string, example: "You do not have access to this conversation" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "BAD_REQUEST"
                  message: "You do not have access to this conversation"
                requestId: "e4f5a6b7-c8d9-0123-ef01-4567890abcde"
        '401':
          description: "Unauthorized - Invalid or expired token."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "UNAUTHORIZED" }
                      message: { type: string, example: "Invalid or expired token" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or expired token"
                requestId: "27fcc299-9b9b-4cfd-a87f-82260d7fc124"
        '404':
          description: "Not Found - Conversation not found."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: false }
                  error:
                    type: object
                    properties:
                      code: { type: string, example: "NOT_FOUND" }
                      message: { type: string, example: "Conversation not found" }
                  requestId: { type: string, format: uuid }
              example:
                success: false
                error:
                  code: "NOT_FOUND"
                  message: "Conversation not found"
                requestId: "f5a6b7c8-d9e0-1234-f012-567890abcdef"

  # --- Message Paths ---
  /v1/conversations/{conversationId}/messages:
    get:
      summary: "Get conversation messages"
      description: "L·∫•y danh s√°ch tin nh·∫Øn trong m·ªôt cu·ªôc tr√≤ chuy·ªán, c√≥ h·ªó tr·ª£ ph√¢n trang."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: page
          in: query
          schema:
            type: integer
            default: 0
          description: "S·ªë trang (b·∫Øt ƒë·∫ßu t·ª´ 0)."
        - name: size
          in: query
          schema:
            type: integer
            default: 50
          description: "K√≠ch th∆∞·ªõc trang."
        - name: sort
          in: query
          schema:
            type: string
            default: "DESC"
            enum: [ASC, DESC]
          description: "Th·ª© t·ª± s·∫Øp x·∫øp theo th·ªùi gian."
      responses:
        '200':
          description: "Messages retrieved successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageListResponse'
        '401':
          description: "Unauthorized."
        '404':
          description: "Conversation not found."
    post:
      summary: "Send a message"
      description: "G·ª≠i m·ªôt tin nh·∫Øn m·ªõi v√†o cu·ªôc tr√≤ chuy·ªán."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatMessageRequest'
      responses:
        '201':
          description: "Message sent successfully."
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse_MessageResponse'
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '404':
          description: "Conversation not found."

  /v1/conversations/{conversationId}/messages/{messageId}:
    get:
      summary: "Get a specific message"
      description: "L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt tin nh·∫Øn c·ª• th·ªÉ."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Message or Conversation not found."
    put:
      summary: "Update a message"
      description: "C·∫≠p nh·∫≠t n·ªôi dung c·ªßa m·ªôt tin nh·∫Øn ƒë√£ g·ª≠i. Ch·ªâ ng∆∞·ªùi g·ª≠i m·ªõi c√≥ th·ªÉ s·ª≠a tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateMessageRequest' }
      responses:
        '200':
          description: "Message updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden."
        '404':
          description: "Message not found."
    delete:
      summary: "Delete a message"
      description: "X√≥a m·ªôt tin nh·∫Øn ƒë√£ g·ª≠i. Ch·ªâ ng∆∞·ªùi g·ª≠i m·ªõi c√≥ th·ªÉ x√≥a tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Message deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden."
        '404':
          description: "Message not found."

  # --- Message Reactions ---
  /v1/messages/{messageId}/reactions:
    post:
      summary: "Add or toggle reaction"
      description: "Th√™m ho·∫∑c toggle reaction (emoji) v√†o tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddReactionRequest' }
      responses:
        '200':
          description: "Reaction toggled successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '404':
          description: "Message not found."
    get:
      summary: "Get message reactions"
      description: "L·∫•y t·∫•t c·∫£ reactions c·ªßa m·ªôt tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Reactions retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Message not found."

  /v1/messages/{messageId}/reactions/{emoji}:
    delete:
      summary: "Remove reaction"
      description: "X√≥a reaction c·ªßa user hi·ªán t·∫°i kh·ªèi tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: emoji
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: "Reaction removed successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageReactionsResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Message not found."

  # --- Read Receipts ---
  /v1/messages/{messageId}/read:
    post:
      summary: "Mark message as read"
      description: "ƒê√°nh d·∫•u m·ªôt tin nh·∫Øn ƒë√£ ƒë·ªçc."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '204':
          description: "Message marked as read successfully."
        '401':
          description: "Unauthorized."
        '404':
          description: "Message not found."

  /v1/messages/{messageId}/receipts:
    get:
      summary: "Get read receipts for message"
      description: "L·∫•y danh s√°ch ng∆∞·ªùi ƒë√£ ƒë·ªçc tin nh·∫Øn."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: messageId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Read receipts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ReadReceiptListResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Message not found."

  /v1/conversations/{conversationId}/mark-read:
    post:
      summary: "Mark conversation as read"
      description: "ƒê√°nh d·∫•u t·∫•t c·∫£ tin nh·∫Øn trong conversation ƒë√£ ƒë·ªçc."
      tags: [Messages]
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema: { type: integer, format: int64 }
        - name: lastMessageId
          in: query
          required: true
          schema: { type: integer, format: int64 }
          description: "ID c·ªßa tin nh·∫Øn cu·ªëi c√πng ƒë√£ ƒë·ªçc."
      responses:
        '204':
          description: "Conversation marked as read successfully."
        '401':
          description: "Unauthorized."
        '404':
          description: "Conversation not found."

  /v1/messages/unread-count:
    get:
      summary: "Get total unread count"
      description: "L·∫•y t·ªïng s·ªë tin nh·∫Øn ch∆∞a ƒë·ªçc t·ª´ t·∫•t c·∫£ conversations."
      tags: [Messages]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Unread count retrieved successfully."
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string }
                  data:
                    type: object
                    properties:
                      unreadCount: { type: integer, format: int64 }
        '401':
          description: "Unauthorized."

  # --- Call Paths ---
  /v1/calls/initiate:
    post:
      summary: "Initiate a new call"
      description: "B·∫Øt ƒë·∫ßu m·ªôt cu·ªôc g·ªçi ƒë·∫øn m·ªôt ng∆∞·ªùi d√πng kh√°c. User ID c·ªßa ng∆∞·ªùi g·ªçi ƒë∆∞·ª£c l·∫•y t·ª´ token x√°c th·ª±c."
      tags: [Call]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/InitiateCallRequest' }
      responses:
        '201':
          description: "Call initiated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."

  /v1/calls/{callId}/accept:
    post:
      summary: "Accept a call"
      description: "Ng∆∞·ªùi nh·∫≠n ch·∫•p nh·∫≠n m·ªôt cu·ªôc g·ªçi ƒë·∫øn. User ID c·ªßa ng∆∞·ªùi nh·∫≠n ƒë∆∞·ª£c l·∫•y t·ª´ token x√°c th·ª±c."
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: "Call accepted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallConnectionResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Call not found."

  /v1/calls/{callId}/reject:
    post:
      summary: "Reject a call"
      description: "Ng∆∞·ªùi nh·∫≠n t·ª´ ch·ªëi m·ªôt cu·ªôc g·ªçi ƒë·∫øn. User ID c·ªßa ng∆∞·ªùi nh·∫≠n ƒë∆∞·ª£c l·∫•y t·ª´ token x√°c th·ª±c."
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/RejectCallRequest' }
      responses:
        '200':
          description: "Call rejected successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Call not found."

  /v1/calls/{callId}/end:
    post:
      summary: "End a call"
      description: "M·ªôt trong hai b√™n k·∫øt th√∫c cu·ªôc g·ªçi. User ID c·ªßa ng∆∞·ªùi th·ª±c hi·ªán h√†nh ƒë·ªông ƒë∆∞·ª£c l·∫•y t·ª´ token x√°c th·ª±c."
      tags: [Call]
      security:
        - bearerAuth: []
      parameters:
        - name: callId
          in: path
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/EndCallRequest' }
      responses:
        '200':
          description: "Call ended successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_CallResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Call not found."

  # --- Contacts Paths ---
  /v1/contacts:
    get:
      summary: "Get all contacts"
      description: "L·∫•y danh s√°ch t·∫•t c·∫£ contacts c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
        '401':
          description: "Unauthorized."
    post:
      summary: "Add a new contact"
      description: "Th√™m m·ªôt contact m·ªõi v√†o danh b·∫°."
      tags: [Contacts]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/AddContactRequest' }
      responses:
        '201':
          description: "Contact added successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."

  /v1/contacts/favorites:
    get:
      summary: "Get favorite contacts"
      description: "L·∫•y danh s√°ch contacts y√™u th√≠ch."
      tags: [Contacts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Favorite contacts retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
        '401':
          description: "Unauthorized."

  /v1/contacts/{contactId}:
    put:
      summary: "Update a contact"
      description: "C·∫≠p nh·∫≠t th√¥ng tin contact (nickname, favorite status)."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateContactRequest' }
      responses:
        '200':
          description: "Contact updated successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '404':
          description: "Contact not found."
    delete:
      summary: "Delete a contact"
      description: "X√≥a m·ªôt contact kh·ªèi danh b·∫°."
      tags: [Contacts]
      security:
        - bearerAuth: []
      parameters:
        - name: contactId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Contact deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Contact not found."

  # --- Friend Requests Paths ---
  /v1/friend-requests:
    post:
      summary: "Send friend request"
      description: "G·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n ƒë·∫øn m·ªôt ng∆∞·ªùi d√πng."
      tags: [Social]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SendFriendRequestRequest' }
      responses:
        '201':
          description: "Friend request sent successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."

  /v1/friend-requests/received:
    get:
      summary: "Get pending friend requests received"
      description: "L·∫•y danh s√°ch l·ªùi m·ªùi k·∫øt b·∫°n ƒë√£ nh·∫≠n."
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Pending requests retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
        '401':
          description: "Unauthorized."

  /v1/friend-requests/sent:
    get:
      summary: "Get pending friend requests sent"
      description: "L·∫•y danh s√°ch l·ªùi m·ªùi k·∫øt b·∫°n ƒë√£ g·ª≠i."
      tags: [Social]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Sent requests retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactListResponse' }
        '401':
          description: "Unauthorized."

  /v1/friend-requests/{requestId}/accept:
    post:
      summary: "Accept friend request"
      description: "Ch·∫•p nh·∫≠n l·ªùi m·ªùi k·∫øt b·∫°n."
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Friend request accepted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_ContactResponse' }
        '401':
          description: "Unauthorized."
        '404':
          description: "Request not found."

  /v1/friend-requests/{requestId}/reject:
    post:
      summary: "Reject friend request"
      description: "T·ª´ ch·ªëi l·ªùi m·ªùi k·∫øt b·∫°n."
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '204':
          description: "Friend request rejected successfully."
        '401':
          description: "Unauthorized."
        '404':
          description: "Request not found."

  /v1/friend-requests/{requestId}:
    delete:
      summary: "Cancel friend request"
      description: "H·ªßy l·ªùi m·ªùi k·∫øt b·∫°n ƒë√£ g·ª≠i."
      tags: [Social]
      security:
        - bearerAuth: []
      parameters:
        - name: requestId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '204':
          description: "Friend request cancelled successfully."
        '401':
          description: "Unauthorized."
        '404':
          description: "Request not found."

  # --- Messenger Notes Paths ---
  /v1/notes:
    post:
      summary: "Create or update note"
      description: |
        T·∫°o ho·∫∑c c·∫≠p nh·∫≠t note (status) c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i.
        - M·ªói user ch·ªâ c√≥ 1 note active t·∫°i m·ªôt th·ªùi ƒëi·ªÉm
        - Note t·ª± ƒë·ªông expire sau 24 gi·ªù
        - T·ªëi ƒëa 60 k√Ω t·ª±
      tags: [Notes]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UserNoteRequest' }
      responses:
        '201':
          description: "Note created successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
    delete:
      summary: "Delete current user's note"
      description: "X√≥a note c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note deleted successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/me:
    get:
      summary: "Get current user's note"
      description: "L·∫•y note c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i (n·∫øu c√≥)."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Note retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/contacts:
    get:
      summary: "Get notes from contacts"
      description: "L·∫•y t·∫•t c·∫£ notes ƒëang active t·ª´ danh s√°ch contacts c·ªßa user. Hi·ªÉn th·ªã trong inbox/chat list."
      tags: [Notes]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: "Notes retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteListResponse' }
        '401':
          description: "Unauthorized."

  /v1/notes/users/{userId}:
    get:
      summary: "Get a specific user's note"
      description: "L·∫•y note c·ªßa m·ªôt user c·ª• th·ªÉ. Ch·ªâ xem ƒë∆∞·ª£c note c·ªßa contacts."
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Note retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_UserNoteResponse' }
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact."
        '404':
          description: "User not found or no active note."

  /v1/notes/{noteId}/reply:
    post:
      summary: "Reply to a note"
      description: |
        Reply v√†o m·ªôt note. Reply s·∫Ω t·∫°o m·ªôt tin nh·∫Øn TEXT trong direct conversation gi·ªØa 2 ng∆∞·ªùi.
        - Reply l√† message th·∫≠t trong conversation
        - C√≥ th·ªÉ reply nhi·ªÅu l·∫ßn
        - Ch·ªâ contacts m·ªõi reply ƒë∆∞·ª£c
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NoteReplyRequest' }
      responses:
        '201':
          description: "Reply sent successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact or replying to own note."
        '404':
          description: "Note not found or expired."

  /v1/notes/{noteId}/react:
    post:
      summary: "React to a note with emoji"
      description: |
        React v√†o m·ªôt note v·ªõi emoji. Reaction s·∫Ω t·∫°o m·ªôt tin nh·∫Øn TEXT v·ªõi n·ªôi dung l√† emoji trong direct conversation.
        - M·ªói reaction l√† 1 message ri√™ng
        - C√≥ th·ªÉ react nhi·ªÅu l·∫ßn v·ªõi emojis kh√°c nhau
        - Ch·ªâ contacts m·ªõi react ƒë∆∞·ª£c
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NoteReactRequest' }
      responses:
        '200':
          description: "Reaction sent successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageResponse' }
        '400':
          description: "Bad Request."
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Not a contact."
        '404':
          description: "Note not found or expired."

  /v1/notes/{noteId}/messages:
    get:
      summary: "Get all messages for a note"
      description: |
        L·∫•y t·∫•t c·∫£ messages (replies + reactions) li√™n quan ƒë·∫øn m·ªôt note.
        - Ch·ªâ note owner m·ªõi xem ƒë∆∞·ª£c
        - Tr·∫£ v·ªÅ danh s√°ch messages t·ª´ conversation
      tags: [Notes]
      security:
        - bearerAuth: []
      parameters:
        - name: noteId
          in: path
          required: true
          schema: { type: integer, format: int64 }
      responses:
        '200':
          description: "Messages retrieved successfully."
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiResponse_MessageListResponse' }
        '401':
          description: "Unauthorized."
        '403':
          description: "Forbidden - Only note owner can view."
        '404':
          description: "Note not found or expired."

